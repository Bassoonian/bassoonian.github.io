<!DOCTYPE html>
<!-- This website was created from scratch by Iasper over the course of years. Please do not shamelessly steal anything - rather, please get in touch and I'll see if I can help you with anything. Besides, the code is so spaghetti I doubt you'll be able to use any of it anyway. Thanks! -->
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title id="page_title">Carite</title>
	<meta name="description" content="An interactive dictionary and grammar of Carite, an Indo-European constructed language.">
	<link rel="icon" type="image/ico" href="carite.ico">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
	<script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
	<script src="jquery.csv.js"></script>
	<script src="constants.js"></script>
	<script src="replacescripts.js"></script>
	<script src="documentation/bibliographies.js"></script>
	<script src="https://kit.fontawesome.com/d0b09f0ca1.js" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="stylesheet.css">
</head>
<body>
	<header class="navbar navbar-expand-md navbar-dark bd-navbar" id="main_header_element">
		<nav class="container-xxl flex-wrap flex-md-nowrap" aria-label="Navigation">
			<span class="navbar-brand mb-0 h1" aria-label="Carite" id="lang_name">Loading...</span>
			<button class="navbar-toggler" type="button" data-bs-target="#bdNavbar" data-bs-toggle="collapse" aria-controls="bdNavbar" aria-expanded="false" aria-label="Toggle navigation">
				<svg class="bi" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
					<path fill-rule="evenodd" d="M2.5 11.5A.5.5 0 0 1 3 11h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4A.5.5 0 0 1 3 7h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4A.5.5 0 0 1 3 3h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"></path>
				</svg>
			</button>
			<div class="navbar-collapse collapse" id="bdNavbar" style>
				<ul class="navbar-nav flex-row flex-wrap bd-navbar-nav pt-2 py-md-0" id="globalnavbarstuffies">
					<li class="nav-item col-6 col-md-auto">
						<a class="nav-link p-2" onclick="switch_tab(0);" id="navbar_button_lexicon" href="javascript:void(0);">Lexicon</a>
					</li>
					<li class="nav-item col-6 col-md-auto">
						<a class="nav-link p-2" onclick="switch_tab(1);" id="navbar_button_docs" href="javascript:void(0);">Documentation</a>
					</li>
				</ul>
				<hr class="d-md-none text-white-50">
				<span class="flex-row flex-wrap ms-md-auto"></span>
				<button class="btn btn-bd-download d-lg-inline-block my-2 my-md-0 ms-md-3" id="settingsbuttontopright" data-bs-toggle="modal" data-bs-target="#searchsettingsmodal" disabled><i class="bi bi-gear-fill"></i></button>
			</div>
		</nav>
	</header>
	
	<nav class="bd-subnavbar py-2" aria-label="Secondary navigation" id="secnavsearchbar" style="display: none;">
		<div class="container-xxl d-flex align-items-md-center">
	    	<form class="bd-search position-relative me-auto">
				<span style="position: relative; display: inline-block; direction: ltr;">
	      			<input class="form-control mr-sm-2 ds-input" type="search" placeholder="Search..." aria-label="Search" id="searchinputvalue" oninput="setWordlist();" spellcheck="false" role="combobox" dir="auto" style="position: relative; vertical-align: top;">
				</span>
	    	</form>
			<button class="btn bd-sidebar-toggle d-md-none py-0 px-1 ms-3 order-3 collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#wordlist" aria-controls="wordlist" aria-expanded="false" aria-label="Toggle navigation">
			      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="bi bi-expand" viewBox="0 0 16 16">
			  <title>Expand</title>
			  <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13A.5.5 0 0 1 1 8zM7.646.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 1.707V5.5a.5.5 0 0 1-1 0V1.707L6.354 2.854a.5.5 0 1 1-.708-.708l2-2zM8 10a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 0 1 .708-.708L7.5 14.293V10.5A.5.5 0 0 1 8 10z"></path>
			</svg>
			      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="bi bi-collapse" viewBox="0 0 16 16">
			  <title>Collapse</title>
			  <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13A.5.5 0 0 1 1 8zm7-8a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 1 1 .708-.708L7.5 4.293V.5A.5.5 0 0 1 8 0zm-.5 11.707l-1.146 1.147a.5.5 0 0 1-.708-.708l2-2a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 11.707V15.5a.5.5 0 0 1-1 0v-3.793z"></path>
			</svg>
			</button>
			<ul class="navbar-nav flex-row flex-wrap ms-md-auto d-none d-xl-flex" id="navbar_alphabetlist"></ul>
		</div>
	</nav>
	
	<div class="container-xxl my-md4 bd-layout" id="head_container_lexicon">
		<aside class="bd-sidebar">
			<nav id="wordlist" class="collapse bd-links" aria-label="Main navigation"></nav>
		</aside>
		<main class="bd-lexicon order-1">
			<div id="loadingcontent" class="container-fluid"><h1>Loading...</h1></div>
			<div id="actualcontent" data-spy="affix" class="container-fluid">
				<div class="alert alert-info alert-dismissable fade show" role="alert" id="wotdnotice">
					<strong>Notice:</strong> This entry was opened automatically as the word of the day.
					<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				</div>
				<h2 id="entry_name"></h2>
				<h3 id="entry_category"></h3>
				<ul class="nav nav-tabs" role="tablist" id="wordTabs">
					<li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#tab_general" id="tab_click_general" role="tab" aria-selected="true" aria-controls="tab_general">General</a></li>
					<li class="nav-item" id="tab_inflect_li"><a class="nav-link" data-bs-toggle="tab" href="#tab_inflection" id="tab_click_inflection" role="tab" aria-selected="false" aria-controls="tab_inflection">Inflection</a></li>
					<li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#tab_etymo" id="tab_click_etymo" role="tab" aria-selected="false" aria-controls="tab_etymo">Etymology</a></li>
					<li class="nav-item" id="tab_sources_li"><a class="nav-link" data-bs-toggle="tab" href="#tab_sources" id="tab_click_sources" role="tab" aria-selected="false" aria-controls="tab_sources">Sources</a></li>
				</ul>
				<div class="tab-content">
					<div id="tab_general" class="tab-pane fade show active" role="tabpanel" aria-labelledby="tab_click_general">
						<div id="altspelling"><h4>Alternative spelling</h4><ul id="altspellingul"></ul></div>
						<h4>Pronunciation</h4>
						<ul id="entry_pronunciation"></ul>
						<p id="dicentry_gender"><b>Gender:</b> <span id="dicentry_gender2"></span></p>
						<div id="translation_tab">
							<h4>Translation</h4>
							<ol id="entry_translations"></ol>
						</div>
						<div id="function_tab"></div>
						<div id="synonyms_tab">
							<h4>Synonyms</h4>
							<ol id="synonym_list"></ol>
						</div>
						<div id="allomorphs_tab">
							<h4>Allomorphs</h4>
							<ul id="allomorphs_list"></ul>
						</div>
						<div id="derivations_tab">
							<h4>Derivations</h4>
							<ul id="derivations_list"></ul>
						</div>
						<p>Last edited: <span id="word_last_edited_span"></span></p>
					</div>
					<div id="tab_inflection" class="tab-pane fade" role="tabpanel" aria-labelledby="tab_click_inflection">
						<h4>Inflection</h4>
						<div id="inflection_content" class="table-responsive"></div>
					</div>
					<div id="tab_etymo" class="tab-pane fade" role="tabpanel" aria-labelledby="tab_click_etymo">
						<h4>Etymology</h4>
						<p id="entry_etymologytext"></p>
						<div id="etymo_relatedwords">
							<h4>Related terms</h4><ul id="etymo_relatedtermslist"></ul>
						</div>
					</div>
					<div id="tab_sources" class="tab-pane fade" role="tabpanel" aria-labelledby="tab_click_sources">
						<div class="alert alert-warning" role="alert" id="libertyalert">
							<strong>Notice:</strong> This entry was added as part of artistic liberty and is as such irrelevant to any actual scientific research.
						</div>
						<h4>Sources</h4>
						<p id="entry_sourcetext"></p>
					</div>
				</div>
		</main>
	</div>

	<div class="container-xxl my-md4 bd-layout" id="head_container_docu" style="display: none;">
		<aside class="bd-sidebar">
			<nav class="collapse bd-links" id="DOC_bd-docs-nav" aria-label="Documentation navigation">Loading...</nav>
		</aside>
		<main class="bd-main order-1">
			<div class="bd-toc mt-4 mb-5 my-md-0 ps-xl-3 mb-lg-5 text-muted">
				<strong class="d-block h6 my-2 pb-2 border-bottom">On this page</strong>
				<nav>
					<ul id="doc_quick_navigation">Loading...</ul>
				</nav>
			</div>
			<div class="bd-content ps-lg-4" id="doc_main_content">
				Loading...
			</div>
		</main>
	</div>

<div class="modal fade" id="searchsettingsmodal" role="dialog">
	<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">Settings</h4>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<div class="alert alert-warning" role="alert" id="localstoragealert">
					<strong>Notice:</strong> Your browser appears to lack support for localStorage. As a result, settings will not be saved between sessions.
				</div>
				<h4>Dictionary Settings</h4>
				<p>Active stage: <select id="stageselectlist" onchange="updateStage();">
					</select>
				</p>
				<p>Pronunciation notation:
					<input type="radio" name="use_xsampa" value="ipa" checked> IPA
					<input type="radio" name="use_xsampa" value="xsampa"> X-SAMPA
				</p>
				<h6>Search Settings</h6>
				<p>Search bar purpose:
					<input type="radio" name="search_destination" value="lang" checked onchange="cleanSearch();"> Language
					<input type="radio" name="search_destination" value="eng" onchange="cleanSearch();"> Translations
					<input type="radio" name="search_destination" value="pie" onchange="cleanSearch();"> PIE
				</p>
				<p>Sort order:
					<input type="radio" name="lex_order" value="alph" checked onchange="refreshOrder();"> Alphabetically
					<input type="radio" name="lex_order" value="time" onchange="refreshOrder();"> By last edited
				</p>
				<!-- <h4>Documentation Settings</h4>
				<p>Include explanations for sound changes: </p>
				<p>Include approximate percentages: </p>
				<p>Include irrelevant sound changes: </p> -->
				<h4>Formatting Settings</h4>
				<h6>Proto-Indo-European</h6>
				<p>Pooth transcription:
					<input type="radio" name="use_pooth" value="yes" onchange="updatePieFormat();"> On
					<input type="radio" name="use_pooth" value="no" checked onchange="updatePieFormat();"> Off
				</p>
				<p>Glides: <select id="glideselect" onchange="updatePieFormat();">
					<option value="0">*w *y</option>
					<option value="1">*u̯ *i̯</option>
				</select></p>
				<p>Palatovelars: <select id="palatoselect" onchange="updatePieFormat();">
					<option value="0">*ḱ *ǵ</option>
					<option value="1">*k̂ *ĝ</option>
				</select></p>
				<p>Aspiration: <select id="aspirateselect" onchange="updatePieFormat();">
					<option value="0">*Kʰ</option>
					<option value="1">*Kh</option>
				</select></p>
				<figure>
				  <blockquote class="blockquote">
				    <p id="pie_settings_sample"></p>
				  </blockquote>
				  <figcaption class="blockquote-footer" id="pie_settings_sample_footer"></figcaption>
				</figure>
				
				<!-- <h6>Early Proto-Carite</h6>
				<p><input type="checkbox" id="showArchaicBox" onchange="updateArchaicBox();"> Use archaic Greek glyphs</p>-->
				<h4>Other</h4>
				<p>Last framework update: <span id="lastdocupdate"></span></p>
				<p>Last lexicon update: <span id="lastlexupdate"></span></p>
				<p><button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#updatemodal">View changelog</button></p>
				<table class="table">
					<thead>
						<tr>
							<th><a href="https://www.discord.com/users/111802386275667968" target="_blank"><i class="bi bi-discord" alt="Discord" title="Discord"></i> Jasper#5206</a></th>
							<th><a href="https://www.reddit.com/user/Iasper/" target="_blank"><i class="fab fa-reddit" alt="Reddit" title="Reddit"></i> /u/Iasper</a></th>
						</tr>
					</thead>
				</table>
			</div>
		</div>
	</div>
</div>

<div class="modal fade" id="updatemodal" role="dialog">
	<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">Changelog</h4>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body" id="updatemodalbody"></div>
			<div class="modal-footer">
				<p><input type="checkbox" id="openUpdateBox" onchange="updateOpenUpdateBox();"> Automatically open changelog after major updates</p>
			</div>
		</div>
	</div>
</div>
</body>
<script>
	//Initialise important variables
	_alphabet=[
		"Α~Ᾱ Β Γ Δ Ε Ζ Η Θ Ι~Ῑ~Ῐ Κ Λ Μ Ν Ξ Ο Π Ρ Σ Τ Υ~Ῡ~Ῠ~Y~Ȳ Φ Ψ Ω",
		"A~Ā~Ą B D E~Ē~Ę F G H~Ḫ I~Ī~Į J K L M N O~Ō~Ǫ P R S T U~Ū~Ų V W Y~Ȳ Ø~Ø̄",
		"A~Ā B D E~Ē~Ę~Ę̄ F G H I~Ī J K L M N O~Ō~Ǫ~Ǭ P R~Ř S T U~Ū~Ų~Ų̄ V W Y~Ȳ Æ~Ǣ Ø~Ø̄",
		"A~Ā B C D E~Ē F G H I~Ī L M N O~Ō P R S T U~Ū V Y~Ȳ Z Æ~Ǣ Ø~Ø̄",
		"A B C D E F G H I J L M N O P Q R S T U V X Y"];
	_needsromanisation=[true,false,false,false,false];
	
	_activeOrtho=[];
	for(var i=0;i<_alphabet.length;i++) _activeOrtho.push(0);
	
	//"normal alphabet1" A~Ā B D E~Ē F G H I~Ī J K L M N O~Ō P R S T U~Ū V W Ȳ Z Ø
	//_alphabet2=["Α Β Γ Δ Ε Ζ Η Ι Κ Λ Μ Ν Ο Π Ρ Σ Τ Υ~Y Ϝ Φ Χ Ψ Ω","","",""];
	//_alphabet2=["𐌀 𐌁 𐌃 𐌄 𐌅 𐌂 𐌇 𐌉 𐌊 𐌋 𐌌 𐌍 𐌏 𐌐 𐌓 𐌔 𐌕 𐌖 𐌆 𐌗","","",""];
	activestage=0;//activestage=_alphabet.length-1;
	includeother=true;
	_navbarcontent="";
	inbibliography=false;
	searchtarget="lang";
	orderalph=true;
	usexsampa=false;
	enablesoundchangetooltips=false;
	showarchaic=false;
	_uidlist=[];
	__pie={
		poothstyle: false,
		glides: false,
		palatals: false,
		aspiration: false
	}
	
	_inDebugMode=false;
	_nonDebugMax=1;
	
	_dataformat={timestyle: "long", datestyle: "long", hour: "2-digit", minute: "2-digit"};
	
	_currentstage=-1;
	
	_siteversion=3;
	
	_viewinglexicon=true;
	
	cognateorder=["grc","pclt","lat","hye","pgmc","pslv","sqi","san","tchA","tchB","toch","hit","eng","eus"];
	
	if (localStorage.settings_secretdebug=="true") _inDebugMode=true;
	
	//Load csv from Google Sheets as javascript array
	loadstr="";
	loadNote("Loading...");
	
	if (_inDebugMode)
	{
		rawcsv=$.get("https://docs.google.com/spreadsheets/d/e/2PACX-1vTe8E8yH60LpBJZA9PfIgIfj7RxmVIPm97PUB1GBHEYPoT9G8dOfyFscqPYhHaEtbQ0Gt3xh6ESfQbF/pub?gid=284553596&single=true&output=csv", function() {
			loadNote("Attempting to connect to server...");
		})
			.done(function(){
				loadNote("Lexicon retrieval succesful!");
				dbase=$.csv.toArrays(rawcsv.responseText);
				parseDbase();
			})
			.fail(function(){
				loadNote("Fetching local copy...");
				rawcsv=$.get("backup_csv.csv", function() {
					loadNote("Attempting to read local file...");
				})
					.done(function(){
						loadNote("Lexicon retrieval succesful!");
						dbase=$.csv.toArrays(rawcsv.responseText);
						parseDbase();
					})
					.fail(function(){
						loadNote("No local copy can be found.");
						loaderror();
					});
			});
	}
	else
	{
		rawcsv=$.get("backup_csv.csv", function() {
			loadNote("Attempting to read local file...");
		})
			.done(function(){
				loadNote("Lexicon retrieval succesful!");
				dbase=$.csv.toArrays(rawcsv.responseText);
				parseDbase();
			})
			.fail(function(){
				loadNote("No local copy can be found.");
				loaderror();
			});
	}
	
	
	function loaderror()
		{
			alert("An error has occurred while loading the lexicon. Please try again later.");
		}
		
	function loadNote(txt)
		{
			if (loadstr!="") loadstr+="</br>";
			loadstr+=txt;
			document.getElementById("loadingcontent").innerHTML=loadstr;
		}
		
	function getWiktionaryLink(a,b)
		{
			var t="https://en.wiktionary.org/wiki/";
			//Reformat b depending on entry
			switch(a)
			{
			case "Proto-Celtic":
				b=replaceAll("f","ɸ",b);
				break;
			case "Latin":
				b=replaceAll("ā","a",b);
				b=replaceAll("ē","e",b);
				b=replaceAll("ī","i",b);
				b=replaceAll("ō","o",b);
				b=replaceAll("ū","u",b);
				break;
			}
			//Fix links
			switch(a)
			{
				case "Late Egyptian": a="Egyptian";break;
				case "Armenian": a="Old Armenian";break;
				case "Proto-Celtic": t+="Reconstruction:Proto-Celtic/";a="";break;
				case "Proto-Slavic": t+="Reconstruction:Proto-Slavic/";a="";break;
				case "Proto-Germanic": t+="Reconstruction:Proto-Germanic/";a="";break;
				case "Proto-Indo-European": t+="Reconstruction:Proto-Indo-European/";a="";break;
				case "Proto-Semitic": t+="Reconstruction:Proto-Semitic/";a="";break;
			}
			t+=b;
			if (a!="") t+="#"+replaceAll(" ","_",a);
			return(t);
		}
	
	function parseDbase()
		{
			//Scouts the array for important bits of information such as the stage names and result/ortho columns
			loadNote("Analysing different stages...");
			maincolumns=[];
			sourcecolumn=-1;
			cognatecolumn=-1;
			formidcolumn=-1;
			lasteditcolumn=-1;
			etymonotecolumn=-1;
			uidcolumn=-1;
			_allomorphs=[];
			
			var k=dbase[1].length;
			for(var i=0;i<k;i++)
			{
				if (dbase[1][i]=="RESULT") maincolumns.push(i);
				if (dbase[1][i]=="COGNATE") cognatecolumn=i;
				if (dbase[1][i]=="SOURCE") sourcecolumn=i;
				if (dbase[1][i]=="FORMID") formidcolumn=i;
				if (dbase[1][i]=="LASTEDIT") lasteditcolumn=i;
				if (dbase[1][i]=="ETYMONOTE") etymonotecolumn=i;
				if (dbase[1][i]=="UID") uidcolumn=i;
			}
			if (maincolumns.length==0)
			{
				loaderror();
				return;
			}
			
			stagelist=[];//List of different stage starts and names
			happenings=[];//Above but also includes loans
			for(var i=3;i<dbase[0].length;i++)
			{
				if (dbase[0][i]!="")//Non-empty in this row means a new stage has started
				{
					stagelist.push([dbase[0][i],i]);
				}
				if (dbase[1][i]=="LOANS"||dbase[1][i]=="RESULT") happenings.push([dbase[2][i],i]);
			}
			loadNote("Stages: "+stagelist);
			loadNote("Happenings: "+happenings.length);
			//Gather words and figure out the size of the lexicon
			lexlist=[];
			var endoflexicon=-1;
			var cat="";
			for(var i=3;i<dbase.length;i++)
			{
				if (dbase[i][0]=="//") cat=dbase[i][1];
				else if (dbase[i][0]=="@@@@")
				{
					endoflexicon=i;
					i=dbase.length;
				}
				else
				{
					if (dbase[i][0].charAt(0)!="§"&&dbase[i][0]!="!!!")
					{
						lexlist.push([i,cat]);
						if (dbase[i][0]=="ALTERNATIVE") _allomorphs.push([dbase[i][1],i]);
					}
					if (dbase[i][uidcolumn]!="") _uidlist.push([dbase[i][uidcolumn],i]);
				}
			}
			if (endoflexicon==-1)
			{
				loaderror();
				return;
			}
			
			__endoflexicon=endoflexicon;
			
			loadNote("Words: "+lexlist.length);
			//Declension lists
			declensionlist=[];
			for(var i=endoflexicon;i<dbase.length;i++)
			{
				if (dbase[i][0]=="//") declensionlist.push([dbase[i][1],i]);
			}
			loadNote("Inflection patterns: "+declensionlist.length);
			
			loadstr=""; //Free up memory
			//Switch from loading screen to actual content
			document.getElementById("loadingcontent").style.display="none";
			document.getElementById("actualcontent").style.display="block";
			document.getElementById("page_title").innerHTML="Carite";
			
			__maxscroll=dbase[0].length;
			
			//If in debug, limit stagelist
			if (!_inDebugMode)
			{
				__maxscroll=stagelist[_nonDebugMax+1][1];
				while(stagelist.length>_nonDebugMax+1) stagelist.pop();
			}
			
			//Update stage list in search menu
			for(var i=0;i<stagelist.length;i++)
			{
				loadstr+="<option";
				if (i==activestage) loadstr+=" selected";
				loadstr+=">"+stagelist[i][0]+"</option>";
			}
			document.getElementById("stageselectlist").innerHTML=loadstr;
			loadstr="";
			
			document.getElementById("pie_settings_sample_footer").innerHTML=parseEtymoText("<i>Schleicher's tale<i> from §encyclopediaieculture",0);
			
			//Load last stage
			loadStage(activestage);
			
			//Update global dates
			var qq=new Date(document.lastModified);
			document.getElementById("lastdocupdate").innerHTML=qq.toLocaleDateString(undefined,_dataformat);
			var tt=0;
			for(var i=0;i<dbase.length;i++)
			{
				var kk=new Date(dbase[i][lasteditcolumn]);
				if (kk>tt) tt=kk;
			}
			var qq=new Date(tt);
			document.getElementById("lastlexupdate").innerHTML=qq.toLocaleDateString(undefined,_dataformat);
			
			//Switch to documentation!
			switch_tab(1);
			syncSettings();
			document.getElementById("settingsbuttontopright").disabled=false;
			document.getElementById("globalnavbarstuffies").style.display="flex";
		}
	function parseAlphabet(stagid)
		{
			//Parse alphabet
			var tempvar="";
			var alph=[];
			alph=_alphabet[stagid].split(" ");
			active_alphabet=[];
			var j=[];
			var alphvalue=0;
			for(var i=0;i<alph.length;i++)
			{
				j=alph[i].split("~");
				if (j.length>1)
				{
					//Dropdown menu
					tempvar+="<li class='nav-item dropdown'><a class='nav-link dropdown-toggle' href='#' role='button' data-bs-toggle='dropdown' aria-expanded='false' id='navbar_dropdown_"+i+"'>"+j[0]+"</a><ul class='dropdown-menu' aria-labelledby='navbar_dropdown_"+i+"'>";
					for(var k=0;k<j.length;k++)
					{
						tempvar+="<li><a class='dropdown-item' href='javascript:void(0);' onclick='scrollToValue("+'"scr'+alphvalue+'"'+")'>"+j[k]+"</a></li>";
						active_alphabet.push(j[k]);
						alphvalue++;
					}
					tempvar+="</ul></li>";
				}
				else
				{
					tempvar+="<li class='nav-item col-6 col-md-auto'><a class='nav-link p-2' href='javascript:void(0);' onclick='scrollToValue("+'"scr'+alphvalue+'"'+")'>"+j[0]+"</a></li>";
					active_alphabet.push(j[0]);
					alphvalue++;
				}
			}
			if (!_viewinglexicon) tempvar="";
			document.getElementById("navbar_alphabetlist").innerHTML=tempvar;
		}
	function loadStage(stagid)
		{
			if (_viewinglexicon) document.getElementById("lang_name").innerHTML=stagelist[stagid][0].toUpperCase();
			if (orderalph) parseAlphabet(stagid);
			else document.getElementById("navbar_alphabetlist").innerHTML="";
			//Create list of terms
			wordlist=[];
			var orth="";
			for(var i=0;i<lexlist.length;i++)
			{
				orth=apply_orthography(dbase[lexlist[i][0]][maincolumns[stagid]],stagid);
				if (orth!=""&&orth!="*") //If empty, this word does not yet/no longer exist in this stage!
				{
					orth2=[];
					orth2.push(orth);
					for(var j=1;j<_spellingsystems[stagid].length;j++) orth2.push(apply_orthography(dbase[lexlist[i][0]][maincolumns[stagid]],stagid,j));
					wordlist.push([orth,orth2,lexlist[i][0],lexlist[i][1],new Date(dbase[lexlist[i][0]][lasteditcolumn])]);
				}
			}
			//Order alphabetically
			if (orderalph) order_alph(stagid);
			else order_lastedit();
			setWordlist(stagid);
			openWotd();
			
			_currentstage=stagid;
		}

	function order_alph(stagid)
		{
			//This function orders the world list alphabetically - either by romanisation or native script
			wordlist.sort(function(a,b){
				return(strSortAlph(a[0].toUpperCase(),b[0].toUpperCase()));
			});
		}
	function order_lastedit()
		{
			wordlist.sort(function(a,b){
				return(a[4].getTime()<b[4].getTime());
			});
		}
	function strSortAlph(a,b)
		{
			a=a.replace(/[-*]/g,"");
			b=b.replace(/[-*]/g,"");
			var t=Math.max(a.length,b.length);
			for(var i=0;i<t;i++)
			{
				var cha=active_alphabet.indexOf(a[i]);
				var chb=active_alphabet.indexOf(b[i]);
				if (cha<chb||cha===undefined) return -1;
				if (cha>chb||chb===undefined) return 1;
			}
			return 0;
		}
		
	function sortByString(a,b,strin)
		{
			var t=Math.max(a.length,b.length);
			for(var i=0;i<t;i++)
			{
				var cha=strin.indexOf(a[i]);
				var chb=strin.indexOf(b[i]);
				if (cha<chb||cha===undefined) return -1;
				if (cha>chb||chb===undefined) return 1;
			}
			return 0;
		}
		
		function replaceAll(find, replace, string) {
			  return string.replace(new RegExp(escapeRegExp(find), 'g'), replace);
			}
			function escapeRegExp(string) {
				    return string.replace(/([.*+?^=!:${}()|\[\]\/\\])/g, "\\$1");
				}
	function setWordlist(stagid)
		{
			var temp="";
			var alphvalue=-1;
			var foundresult=0;
			var timevalue="";
			var searchval=document.getElementById("searchinputvalue").value;
			var check=0;
			for(var i=0;i<wordlist.length;i++)
			{
				var j="";
				if (!orderalph)
				{
					var checktime=new Date(wordlist[i][4]);
					var ccq=checktime.toLocaleDateString(undefined,{timestyle: "short"});
					if (wordlist[i][4]=="") ccq="Unknown";
					if (timevalue!=ccq)
					{
						//if (timevalue!="") temp+="</div>";
						timevalue=ccq;
						temp+="<h5 class='alphabetstripe'><span>"+timevalue+"</span></h5>";
					}
				}
				if (orderalph)
				{
					var j=wordlist[i][check].charAt(0).toUpperCase();
					if(j=="-"||j=="*") j=wordlist[i][check].charAt(1).toUpperCase();
					if(j=="-") j=wordlist[i][check].charAt(2).toUpperCase();
					while(alphvalue<active_alphabet.indexOf(j))
					{
						alphvalue++;
						//if (alphvalue>0) temp+="</div>";
						temp+="<h5 class='alphabetstripe' id='scr"+alphvalue+"'><span>"+active_alphabet[alphvalue]+"</span></h5>";
					}
				}
				var success=false;
				if (searchval=="") success=true;
				else
				{
					searchval=searchval.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
					if (searchtarget=="eng")
					{
						var qqq=dbase[wordlist[i][2]][maincolumns[activestage]+1].normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
						if (qqq.search(searchval)!=-1) success=true;
					}
					else if (searchtarget=="pie")
					{
						for(var j=0;j<3;j++)
						{
							var qqq=formatPie(dbase[wordlist[i][2]][j],(j==0)).normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
							if (qqq.search(searchval)!=-1) success=true;
						}
					}
					else
					{
						for(var j=0;j<wordlist[i][1].length;j++)
						{
							var qqq=wordlist[i][1][j].normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
							if (qqq.search(searchval)!=-1) success=true;
						}
					}
				}
				if (success==true)
				{
					temp+="<li><a href='javascript:void(0);' class='d-inline-flex align-items-center rounded lexiconentry' onclick='openWord("+i+",false);collapseIfMobile();'><span class='wordlistentry'>"+display(wordlist[i]);
					temp+="<span class='wordlistcategory'>";
					j=wordlist[i][3];
					for(var k=0;k<declensionlist.length;k++)
					{
						if (declensionlist[k][0]==wordlist[i][3]) j=dbase[declensionlist[k][1]][2];
					}
					temp+=(j.split("|"))[0]+"</span>";
					temp+="</span></a></li>";
					foundresult++;
				}
			}
			if (orderalph)
			{
				while(alphvalue<active_alphabet.length-1)
				{
					alphvalue++;
					if (alphvalue>0) temp+="</div>";
					temp+="<div id='scr"+alphvalue+"'><h5 class='alphabetstripe'><span>"+active_alphabet[alphvalue]+"</span></h5>";
				}
			}
			temp+="</div>";
			//Attach amount of found entries
			temp=" found.</small></span><ul class='list-unstyled mb-0 py-3 pt-md-1'>"+temp;
			if (foundresult==1) temp="entry"+temp;
			else temp="entries"+temp;
			temp="<span id='entryamountbox' class='container-fluid'><small>"+numberWithCommas(foundresult)+" "+temp;
			document.getElementById("wordlist").innerHTML=temp+"</ul>";
		}
	function display(term)
		{
			var qq=term[0];
			if (activestage==0) qq=applyArchaic(qq);
			return(qq);
		}
	function numberWithCommas(x) {
		    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
		}
	function openWotd()
		{
			var now=Date.now();//milliseconds
			now=Math.floor(now/1000);//seconds
			now=Math.floor(now/60);//minutes
			now=Math.floor(now/60);//hours
			now=Math.floor(now/24);//days
			now*=now;
			var wid=now % (wordlist.length-1);
			openWord(wid,true);
		}
	function getPronunciation(word)
		{
			word=word.toLowerCase();
			word=replaceAll("^","",word);
			word=pronFixOrtho(word,activestage);
			//applyalways
			if (activestage<4)
			{
				word=replaceAll("ā","aː",word);
				word=replaceAll("ē","eː",word);
				word=replaceAll("ê","eːː",word);
				word=replaceAll("ī","iː",word);
				word=replaceAll("ō","oː",word);
				word=replaceAll("ô","oːː",word);
				word=replaceAll("ū","uː",word);
				word=replaceAll("ȳ","yː",word);
				word=replaceAll("ø̄","øː",word);
				word=replaceAll("̄","ː",word);
			}
			if (activestage==1||activestage==2) word=replaceAll("ǣ","æː",word);
			if (activestage>0&&activestage<3)
			{
				word=replaceAll("ą̄","ãː",word);
				word=replaceAll("ę̄","ẽː",word);
				word=replaceAll("į̄","ĩː",word);
				word=replaceAll("ǭ","õː",word);
				word=replaceAll("ų̄","ũː",word);
				word=replaceAll("ǣ̨","æ̃ː",word);
				word=replaceAll("ø̨̄","ø̃ː",word);
				word=replaceAll("ȳ̨","ỹː",word);
				word=replaceAll("ą","ã",word);
				word=replaceAll("ę","ẽ",word);
				word=replaceAll("į","ĩ",word);
				word=replaceAll("ǫ","õ",word);
				word=replaceAll("ų","ũ",word);
				word=replaceAll("æ̨","æ̃",word);
				word=replaceAll("ø̨","ø̃",word);
				word=replaceAll("y̨","ỹ",word);
			}
			if (activestage==2) word=replaceAll("ř","ʁ",word);
			//split into syllables
			for(var i=0;i<_vowels[activestage].length;i++)
			{
				word=replaceAll(_vowels[activestage][i],"§"+_vowels[activestage][i]+"§",word);
			}
			//Fix semivowels
			for(var i=0;i<_vowels[activestage].length;i++)
			{
				word=replaceAll("§§"+_vowels[activestage][i]+"§̯",_vowels[activestage][i]+"̯§",word);
			}
			word=replaceAll("§§ː","ː",word);
			var q=word.split("§");
			word=".";
			for(var i=0;i<q.length;i++)
			{
				if (_vowels[activestage].includes(q[i].charAt(0))) //is a syllabic component
				{
					word+=q[i];
				}
				else
				{
					if (i==q.length-1||i==0) word+=q[i];
					else
					{
						var t="";
						var k=q[i];
						if (k.includes("'"))
						{
							t=(k.split("'"))[0];
							k="'"+(k.split("'"))[1];
						}
						var p="";
						for(var tt=0;tt<_illegalonsets[activestage].length;tt++)
						{
							if (k.startsWith(_illegalonsets[activestage][tt]))
							{
								t+=k.charAt(0);
								k=k.slice(1);
								tt=0;
							}
						}
						word+=t+"."+k;
					}
				}
			}
			//apply stress
			if (activestage<2&&!word.includes("-"))
			{
				if (word.includes("'")) word=word.replace("'","ˈ"); //If stress is manually defined, override
				else word=word.replace(".",".ˈ"); //Primary stress
			}
			if (activestage==2)
			{
				//Penultimate stress
				var q=word.split(".");
				if (q.length>2) q[q.length-2]="ˈ"+q[q.length-2];
				else q[1]="ˈ"+q[1];
				word=q.join(".");
			}
			if (activestage==3)
			{
				//Penultimate stress
				var q=word.split(".");
				if (q.length>2) q[q.length-2]="ˈ"+q[q.length-2];
				else q[1]="ˈ"+q[1];
				//Fix up %
				if (q.length>1)
				{
					if (q[q.length-1].includes("%"))
					{
						var p=q[q.length-1];
						p=p.replace(/([mnlr])(ʲ?ʷ?ʲ?ʷ?ʲ?)\%/g,"$1̩$2")
						if (p==q[q.length-1])
						{
							q[q.length-2]+=q[q.length-1].replace("%","");
							q.pop();
						}
						else q[q.length-1]=p;
					}
				}
				word=q.join(".");
				//Fix "oversyllabic" sonorants
				word=word.replace(/([aeiouyæø]ː?).([mnlr])̩/g,"$1$2");
			}
			word=word.replace("ˈ-","-");
			//finalise
			word=word.replace(".","");
			
			//applyalways + allophones
			word=pronAlways(word);
			if (activestage==0&&word.includes("ŋ")) word="["+word+"]";
			else word="/"+word+"/, "+pronAllophones(word);
			word=replaceAll("g","ɡ",word);
			word=word.replace(/([a-z])(\1)/g,"$1ː");
			
			//Fix .C₁C₁ > C₁.C₁
			word=word.replace(/\.(ˈ?)([mnɲŋpbtdkɡszʃʒɸβfvθðxɣχʁhwjɾrlʎ])ː/g,"$2.$1$2");
			
			//xsampa conversion if necessary
			if (usexsampa) word=IPAtoXSampa(word);
			return(word);
		}
	function pronFixOrtho(w,s)
		{
			w=w.normalize('NFC');
			//Augment fuckeries
			if (s==0)
			{
				w=w.replace(/(e-)([aā])/g,"ā");
				w=w.replace(/(e-)([eē])/g,"ē");
				w=w.replace(/(e-)([iī])/g,"ī");
				w=w.replace(/(e-)([oō])/g,"ō");
				w=w.replace(/(e-)([uū])/g,"ū");
				w=w.replace(/(e-)([yȳ])/g,"ȳ");
				w=w.replace(/(e-)([øø̄])/g,"ø̄");
				w=w.replace(/(e-)([^$])/g,"e$2");
			}
			
			//Nasal assimilation
			w=w.replace(/(n)([mpb])/g,"m$2");
			w=w.replace(/(m)([sztd])/g,"n$2");
			//Osthoff's law
			w=w.replace(/(ā)([wjmnlriu][mnpbtdkgszfvjwlr])/g,"a$2");
			w=w.replace(/(ē)([wjmnlriu][mnpbtdkgszfvjwlr])/g,"e$2");
			w=w.replace(/(ī)([wjmnlriu][mnpbtdkgszfvjwlr])/g,"i$2");
			w=w.replace(/(ō)([wjmnlriu][mnpbtdkgszfvjwlr])/g,"o$2");
			w=w.replace(/(ū)([wjmnlriu][mnpbtdkgszfvjwlr])/g,"u$2");
			w=w.replace(/(ȳ)([wjmnlriu][mnpbtdkgszfvjwlr])/g,"y$2");
			w=w.replace(/(ǣ)([wjmnlriu][mnpbtdkgszfvjwlr])/g,"æ$2");
			w=w.replace(/(ø̄)([wjmnlriu][mnpbtdkgszfvjwlr])/g,"ø$2");
			//Merge stuff
			
			//Remove nasal vowel length in s1
			if (s==1)
			{
				w=w.replace(/([ąęįǫų])(̄)/g,"$1");
				w=w.replace(/ǭ/g,"ǫ");
			}
			
			//Break up vowels! to do
			//initial mutation
			if (s==2)
			{
				w=replaceAll("$b","β",w); //FIX TO ONLY COUNT IF A VOWEL FOLLOWS!
				w=replaceAll("$d","ð",w); //FIX TO ONLY COUNT IF A VOWEL FOLLOWS!
				w=replaceAll("$g","ɣ",w); //FIX TO ONLY COUNT IF A VOWEL FOLLOWS!
				w=w.replace(/(\$)([aāeēiīoōuūyȳøø̄æǣęę̄ǫǭųų̄])/g,"j$2");
				w=replaceAll("$","",w);
			}
			
			//Neutralise velar/palatal
			if (s==3)
			{
				w=replaceAll("$b","v",w); //FIX TO ONLY COUNT IF A VOWEL FOLLOWS!
				w=replaceAll("$d","ð",w); //FIX TO ONLY COUNT IF A VOWEL FOLLOWS!
				w=replaceAll("$g","ɣ",w); //FIX TO ONLY COUNT IF A VOWEL FOLLOWS!
				w=w.replace(/(\$)([aāeēiīoōuūyȳøø̄æǣ])/g,"j$2");
				w=replaceAll("$","",w);
				
				w=replaceAll("ʲʲ","ʲ",w);
				w=replaceAll("ʷʷ","ʷ",w);
				w=replaceAll("ʲʷ","ʲ",w);
				w=replaceAll("ʷʲ","ʷ",w);
				w=replaceAll("jʲ","j",w);
				
				w=w.replace(/([aāeēiīoōuūyȳøø̄æǣęę̄ǫǭųų̄])(d)\%$/g,"$1ð%");
				w=w.replace(/([aāeēiīoōuūyȳøø̄æǣęę̄ǫǭųų̄])(g)\%$/g,"$1ɣ%");
			}
			return(w);
		}
	function pronAlways(w)
		{
			// voicing assimilation?
			//bdg > BDG
			if (activestage==2) w=w.replace(/([ːaeiouyæøãẽõũ]ː?\.ˈ?)(b)([aāeēiīoōuūyȳøø̄æǣąą̄ęę̄ǫǭųų̄])/g,"$1β$3");
			if (activestage==2||activestage==3)
			{
				w=w.replace(/([ːaeiouyæøãẽõũ]ː?\.ˈ?)(d)([aāeēiīoōuūyȳøø̄æǣąą̄ęę̄ǫǭųų̄])/g,"$1ð$3");
				w=w.replace(/([ːaeiouyæøãẽõũ]ː?\.ˈ?)(g)([aāeēiīoōuūyȳøø̄æǣąą̄ęę̄ǫǭųų̄])/g,"$1ɣ$3");
			}
			if (activestage==3)
			{
				w=w.replace(/(n)(\.?ˈ?[wkgx])/g,"ŋ$2");
			}
			return(w);
		}
	function pronAllophones(w)
		{
			//Nasal and labiodental velar
			if (activestage<3) w=w.replace(/(n)(\.?ˈ?[wkg])/g,"ŋ$2");
			w=w.replace(/(m)(\.?ˈ?[fv])/g,"ɱ$2");
			
			if (activestage==1)
			{
				//Nasal vowel length
				w=w.replace(/([ãẽĩõũỹø̃])(.?[pbtdkgmnlrszfvjw])/g,"$1ː$2"); //Word-medially
				w=w.replace(/(^|\s)([^aeiouyøãẽĩõũ\s]*)([ãẽĩõũ])(?=$|\s)/g,"$1$2$3ː"); //Word-finally in monosyllables
				w=w.replace(/õi̯/g,"õĩ̯");
			}
			
			if (activestage==2) w=replaceAll("ʁ","ʁ̞",w);
			
			if (activestage==3) w=w.replace(/(s)(\.?ˈ?[ptkmn])/g,"ʃ$2");
			return("["+w+"]");
		}
	function parseTransCondition(text)
		{
			var out=text;
			for(var i=0;i<glossterms.length;i++) out=out.replace(glossterms[i][0].toUpperCase(),glossText(glossterms[i][0],glossterms[i][1]));
			if (out==text) out="<i>"+text+"</i>";
			return(out);
		}
	function openWord(wid,first)
		{
			if (!first) $('#wotdnotice').alert("close");
			
			var ttab=new bootstrap.Tab(document.querySelector('#tab_click_general'));
			ttab.show();
			
			_last_opened=wid;
			document.getElementById("entry_name").innerHTML=display(wordlist[wid]);
			var j="";
			var amalternative=(dbase[wordlist[wid][2]][0]=="ALTERNATIVE");
			if (amalternative) document.getElementById("tab_sources_li").style.display="none";
			else document.getElementById("tab_sources_li").style.display="initial";
			var clid=-1;
			for(var i=0;i<declensionlist.length;i++)
			{
				if (declensionlist[i][0]==wordlist[wid][3])
				{
					j=dbase[declensionlist[i][1]][2];
					clid=i;
				}
			}
			document.getElementById("entry_category").innerHTML=(j.split("|"))[0];
			var wordcategoryopen=j;
			
			//Alternative spellings
			document.getElementById("altspelling").style.display="none";
			if (_spellingsystems[activestage].length>1)
			{
				document.getElementById("altspelling").style.display="initial";
				temp="";
				for(var i=0;i<_spellingsystems[activestage].length;i++)
				{
					if (i!=_activeOrtho[activestage]) temp+="<li>(<i>"+_spellingsystems[activestage][i]+"</i>) "+apply_orthography(dbase[wordlist[wid][2]][maincolumns[activestage]],activestage,i)+"</li>";
				}
				document.getElementById("altspellingul").innerHTML=temp;
			}
			
			//Translation
			var temp="";
			if (!amalternative)
			{
				var translist=dbase[wordlist[wid][2]][maincolumns[activestage]+1].split(",");
				for(var i=0;i<translist.length;i++)
				{
					temp+="<li>";
					var k=translist[i].split("£");
					if (k.length>1) temp+="("+parseTransCondition(k[1])+") ";
					temp+=replaceAll("&",",",k[0]);
					temp+="</li>";
				}
				document.getElementById("entry_translations").innerHTML=temp;
				document.getElementById("translation_tab").style.display="initial";
				document.getElementById("function_tab").style.display="none";
			}
			else
			{
				document.getElementById("function_tab").style.display="initial";
				document.getElementById("translation_tab").style.display="none";
				var q=-1;
				for(var i=0;i<_uidlist.length;i++)
				{
					if (_uidlist[i][0]==dbase[wordlist[wid][2]][1])
					{
						q=_uidlist[i][1];
						i=_uidlist.length;
					}
				}
				document.getElementById("function_tab").innerHTML="<p>Allomorph of <a class='clickety' href='javascript:void(0);' onclick='timeTravel("+q+","+activestage+");'>"+apply_orthography(dbase[q][maincolumns[activestage]],activestage)+"</a> "+dbase[wordlist[wid][2]][maincolumns[activestage]+1]+".</p>";
			}
			
			//Build pronunciation
			temp=dbase[wordlist[wid][2]][maincolumns[activestage]].toLowerCase();
			temp=getPronunciation((temp.split("~"))[0]);
			temp="<li>"+temp+"</li>";
			document.getElementById("entry_pronunciation").innerHTML=temp;
			
			//Find synonyms
			document.getElementById("synonyms_tab").style.display="initial";
			temp="";
			if (!amalternative)
			{
				for(var i=0;i<translist.length;i++)
				{
					var ttt=[];
					for(var j=0;j<wordlist.length;j++)
					{
						var l=wordlist[j][2];
						var m=dbase[l][maincolumns[activestage]+1].split(",");
						for(var k=0;k<m.length;k++)
						{
							if (translist[i]==m[k]&&j!=wid) ttt.push(j);
						}
					}
					if (ttt.length>0)
					{
						temp+="<li>(<i>"+(translist[i].split("£"))[0]+"</i>): ";
						for(var j=0;j<ttt.length;j++)
						{
							if (j>0) temp+=", ";
							temp+="<a class='clickety' href='javascript:void(0);' onclick='openWord("+ttt[j]+",false);'>"+wordlist[ttt[j]][0]+"</a>";
						}
						temp+="</li>";
					}
				}
			}
			document.getElementById("synonym_list").innerHTML=temp;
			if (temp=="") document.getElementById("synonyms_tab").style.display="none";
			
			//Allomorphs
			document.getElementById("allomorphs_tab").style.display="none";
			if (dbase[wordlist[wid][2]][uidcolumn]!="")//Has an id
			{
				temp="";
				for(var i=0;i<_allomorphs.length;i++)
				{
					if (_allomorphs[i][0]==dbase[wordlist[wid][2]][uidcolumn]&&dbase[_allomorphs[i][1]][maincolumns[activestage]]!="") temp+="<li>(<i>"+dbase[_allomorphs[i][1]][maincolumns[activestage]+1]+"</i>) <a class='clickety' href='javascript:void(0);' onclick='timeTravel("+_allomorphs[i][1]+","+activestage+");'>"+apply_orthography(dbase[_allomorphs[i][1]][maincolumns[activestage]],activestage)+"</a></li>";
				}
				document.getElementById("allomorphs_list").innerHTML=temp;
				if (temp!="") document.getElementById("allomorphs_tab").style.display="initial";
			}
			
			//Derivations
			document.getElementById("derivations_tab").style.display="none";
			if (dbase[wordlist[wid][2]][uidcolumn]!="")//Has an id
			{
				temp="";
				var qq=[];
				for(var i=0;i<happenings.length;i++)
				{
					if (happenings[i][1]==maincolumns[activestage]) i=happenings.length;
					else if (happenings[i][0]!="VVV")
					{
						for(var j=0;j<dbase.length;j++)
						{
							if (dbase[j][0]=="@@@@") j=dbase.length;
							else
							{
								var k=dbase[j][happenings[i][1]].split(" ");
								if (k[0]=="D")
								{
									for(var l=1;l<k.length;l++)
									{
										if (k[l]==dbase[wordlist[wid][2]][uidcolumn])
										{
											if (!qq.includes(l)) qq.push(j);
										}
									}
								}
							}
						}
					}
				}
				if (qq.length>0)
				{
					for(var i=0;i<wordlist.length;i++)
					{
						if (qq.includes(wordlist[i][2])) temp+="<li><a class='clickety' href='javascript:void(0);' onclick='openWord("+i+",false);'>"+wordlist[i][0]+"</a></li>";
					}
				}
				document.getElementById("derivations_list").innerHTML=temp;
				if (temp!="") document.getElementById("derivations_tab").style.display="initial";
			}
			
			//Build etymology
			temp="";
			var prevmeaning="";
			var startingpoint=-1;
			var checkpie=true;
			var isloan=false;
			document.getElementById("libertyalert").style.display="none";
			for(var i=0;i<happenings.length;i++)
			{
				if (happenings[i][1]==maincolumns[activestage])
				{
					startingpoint=i;
					i=happenings.length;
				}
			}
			//Backwards
			for(var i=startingpoint-1;i>=0;i--)
			{
				if (dbase[wordlist[wid][2]][happenings[i][1]]!="")
				{
					if (temp!="") temp+=", ";
					if (happenings[i][0]=="VVV")
					{
						//It's a stage!
						var showmeaning="";
						if (prevmeaning!=dbase[wordlist[wid][2]][happenings[i][1]+1])
						{
							prevmeaning=dbase[wordlist[wid][2]][happenings[i][1]+1];
							showmeaning=prevmeaning;
						}
						else showmeaning="id.";
						if (amalternative) showmeaning="";
						temp+="from "+etymoStep(maincolumns.indexOf(happenings[i][1]),wordlist[wid][2],showmeaning);
					}
					else
					{
						var evaluate=dbase[wordlist[wid][2]][happenings[i][1]].split(" ");
						switch(evaluate[0].charAt(0))
						{
							case "L"://Loan
								evaluate[0]=evaluate[0].slice(1);
								if (evaluate[0]=="artlib") document.getElementById("libertyalert").style.display="inherit";
								temp+=parseLoan(evaluate,happenings[i][0]);
								isloan=true;
								break;
							case "D":
								checkpie=false;
								temp+="from";
								var tt=[];
								for(var j=1;j<evaluate.length;j++)
								{
									temp+=" ";
									if (j>1) temp+="+ ";
									var qq=-1;
									for(var k=0;k<_uidlist.length;k++)
									{
										if (evaluate[j]==_uidlist[k][0]) qq=k;
									}
									if (qq==-1) temp+="?";
									else
									{
										temp+=etymoStep(i,_uidlist[qq][1],dbase[_uidlist[qq][1]][maincolumns[i]+1],false);
										if (dbase[_uidlist[qq][1]][maincolumns[activestage]]!="") tt.push(_uidlist[qq][1]);
									}
								}
								if (i!=activestage&&tt.length==evaluate.length-1)
								{
									temp+="; equivalent to";
									for(var k=0;k<tt.length;k++)
									{
										temp+=" ";
										if (k>0) temp+="+ ";
										if (tt[k]==-1) temp+="!";
										else temp+=etymoStep(activestage,tt[k],"",false);
									}
								}
								document.getElementById("tab_sources_li").style.display="none";
								break;
							case "P":
								checkpie=false;
								temp+="prefixal usage of the preposition ";
								var k=-1;
								for(var j=0;j<_uidlist.length;j++)
								{
									if (evaluate[1]==_uidlist[j][0]) k=j;
								}
								temp+="<a href='javascript:void(0);' class='clickety' onclick='timeTravel("+_uidlist[k][1]+","+i+");'>"+apply_orthography(dbase[_uidlist[k][1]][maincolumns[i]],i)+"</a>";
								document.getElementById("tab_sources_li").style.display="none";
								break;
						}
						i=-1;//End of journey
					}
				}
			}
			if (checkpie&&!amalternative)
			{
				if (dbase[wordlist[wid][2]][2]!="")
				{
					if (temp!="") temp+=", ";
					temp+="from Pre-"+stagelist[0][0]+" <i>*"+formatPie(dbase[wordlist[wid][2]][2],false)+"</i>";
				}
				if (dbase[wordlist[wid][2]][1]!="")
				{
					if (temp!="") temp+=", ";
					if (isloan)
					{
						temp+="ultimately ";
						isloan=false;
					}
					temp+="from "+formatCognate(["pie",dbase[wordlist[wid][2]][1]],false);
				}
				if (dbase[wordlist[wid][2]][0]!="")
				{
					if (temp!="") temp+=", ";
					var pp="!";
					if (isloan)
					{
						temp+="ultimately ";
						pp="";
					}
					temp+="derived from the root "+formatCognate([pp+"pie",dbase[wordlist[wid][2]][0]],false,true);
				}
			}
			if (amalternative)
			{
				var q=-1;
				for(var i=0;i<_uidlist.length;i++)
				{
					if (_uidlist[i][0]==dbase[wordlist[wid][2]][1])
					{
						q=_uidlist[i][1];
						i=_uidlist.length;
					}
				}
				if (temp!="") temp+=", which ";
				temp+="branched off <a class='clickety' href='javascript:void(0);' onclick='timeTravel("+q+","+activestage+");'>"+apply_orthography(dbase[q][maincolumns[activestage]],activestage)+"</a> "+dbase[wordlist[wid][2]][maincolumns[activestage]+1];
				
			}
			//Forwards
			var prevmeaning="";
			for(var i=activestage+1;i<stagelist.length;i++)
			{
				if (dbase[wordlist[wid][2]][maincolumns[i]]=="") i=stagelist.length;
				else
				{
					var showmeaning="";
					if (prevmeaning=="")
					{
						if (temp!="") temp+=". ";
						temp+="Regularly develops into ";
						prevmeaning=dbase[wordlist[wid][2]][maincolumns[i]+1];
						showmeaning=prevmeaning;
					}
					else if (prevmeaning!=dbase[wordlist[wid][2]][maincolumns[i]+1])
					{
						prevmeaning=dbase[wordlist[wid][2]][maincolumns[i]+1];
						showmeaning=prevmeaning;
						temp+=", whence ";
					}
					else
					{
						showmeaning="id.";
						temp+=", whence ";
					}
					if (amalternative) showmeaning="";
					temp+=etymoStep(i,wordlist[wid][2],showmeaning);
				}
			}
			
			temp=(temp.charAt(0).toUpperCase()+temp.slice(1)+".").replace("..",".");
			//Handle cognates and formids
			var tk=[];
			for(var i=0;i<2;i++)
			{
				tk.push(wordlist[wid][2]);
				if (i==0) var tp=dbase[wordlist[wid][2]][cognatecolumn];
				if (i==1) var tp=dbase[wordlist[wid][2]][formidcolumn];
				if (tp.charAt(0)==">")
				{
					var tp=tp.replace(">","");
					for (var j=0;j<_uidlist.length;j++)
					{
						if (tp==_uidlist[j][0]) tk[i]=_uidlist[j][1];
					}
				}
			}
			
			var coggies1=dbase[tk[0]][cognatecolumn].split(",");
			var formies1=dbase[tk[1]][formidcolumn].split(",");
			
			if (tk[1]!=wordlist[wid][2])
			{
				coggies1=coggies1.concat(formies1);
				formies1=[""];
			}
			
			var coggies2=[];
			var formies2=[];
			//Break up further
			for(var i=0;i<coggies1.length;i++)
			{
				coggies2.push((coggies1[i].trim()).split(" "));
			}
			for(var i=0;i<formies1.length;i++)
			{
				formies2.push((formies1[i].trim()).split(" "));
			}
			//Sort by language order
			coggies2.sort(function(a,b){return cognateorder.indexOf(a[0])-cognateorder.indexOf(b[0]);});
			formies2.sort(function(a,b){return cognateorder.indexOf(a[0])-cognateorder.indexOf(b[0]);});
			if (coggies2[0]!=""||formies2[0]!="")
			{
				temp+=" "
				var hasformids=false;
				//Start with formally identicals
				if (formies2[0]!="")
				{
					hasformids=true;
					temp+="Formally identical to ";
					for(var i=0;i<formies2.length;i++) {if (i==formies2.length-1&&i!=0) temp+=" and ";else if (i>0) temp+=", "; temp+=formatCognate(formies2[i],false);}
				}
				if (coggies2[0]!="")
				{
					if (hasformids) temp+=" while cognate with ";
					else temp+="Cognate with ";
					for(var i=0;i<coggies2.length;i++) {if (i==coggies2.length-1&&i!=0) temp+=" and ";else if (i>0) temp+=", "; temp+=formatCognate(coggies2[i],false);}
				}
				temp+=".";
			}
			
			if (dbase[wordlist[wid][2]][etymonotecolumn]!="") temp+=" "+parseEtymoText(dbase[wordlist[wid][2]][etymonotecolumn],activestage);
			document.getElementById("entry_etymologytext").innerHTML=temp;
			
			//Get related terms
			document.getElementById("etymo_relatedwords").style.display="initial";
			temp="";
			if (!amalternative)
			{
				var check1=dbase[wordlist[wid][2]][0];
				var check2=dbase[wordlist[wid][2]][1];
				var check3=dbase[wordlist[wid][2]][1];
				if (check1!=""||check2!=""||check3!="")
				{
					for(var i=0;i<wordlist.length;i++)
					{
						var goahead=false;
						if (check1==dbase[wordlist[i][2]][0]&&check1!="") goahead=true;
						if (check2==dbase[wordlist[i][2]][1]&&check2!="") goahead=true;
						if (check3==dbase[wordlist[i][2]][2]&&check3!="") goahead=true;
						if (goahead&&i!=wid) temp+="<li><a href='javascript:void(0);' class='clickety' onclick='openWord("+i+",false);'>"+wordlist[i][0]+"</a></li>";
					}
				}
			}
			document.getElementById("etymo_relatedtermslist").innerHTML=temp;
			if (temp=="") document.getElementById("etymo_relatedwords").style.display="none";
			
			//Set sources
			var ttr=wordlist[wid][2];
			if (dbase[ttr][sourcecolumn].charAt(0)==">")
			{
				var kkk=dbase[ttr][sourcecolumn].replace(">","");
				for(var i=0;i<_uidlist.length;i++)
				{
					if (_uidlist[i][0]==kkk) ttr=_uidlist[i][1];
				}
			}
			
			temp=dbase[ttr][sourcecolumn];
			if (temp=="") temp="No source specified. If you believe you have a source that may be relevant, please get in touch.";
			else temp="<ol>"+list_sources(temp.split(","))+"</ol>";
			document.getElementById("entry_sourcetext").innerHTML=temp;
			
			//Set inflection table
			document.getElementById("dicentry_gender").style.display="none";
			document.getElementById("tab_inflect_li").style.display="none";
			temp="";
			if (wordcategoryopen=="Noun"||wordcategoryopen=="Suffix|N")
			{
				document.getElementById("tab_inflect_li").style.display="initial";
				temp+=tableNoun(wordlist[wid][2],wordlist[wid][3],activestage,true,-1);
			}
			if (wordlist[wid][3]=="PRON_PERS_1"||wordlist[wid][3]=="PRON_PERS_2")
			{
				document.getElementById("tab_inflect_li").style.display="initial";
				temp+=tablePersPronoun(wordlist[wid][3],activestage);
			}
			if (wordlist[wid][3]=="PRON_PERS_3")
			{
				document.getElementById("tab_inflect_li").style.display="initial";
				temp+=tablePronounIrregular(wordlist[wid][3],activestage);
			}
			if (wordcategoryopen=="Adjective"||(wordcategoryopen=="Numeral"&&wordlist[wid][3]!="NUM_GEN")||wordcategoryopen=="Suffix|A")
			{
				document.getElementById("tab_inflect_li").style.display="initial";
				//Positive
				temp+=tableAdjective(wordlist[wid][2],wordlist[wid][3],activestage,(wordcategoryopen=="Numeral"),-1,0);
				if (wordcategoryopen!="Numeral")
				{
					//Comparative
					temp+="<h4>Comparative</h4>"+tableAdjective(wordlist[wid][2],wordlist[wid][3],activestage,false,-1,1);
					//Superlative
					temp+="<h4>Superlative</h4>"+tableAdjective(wordlist[wid][2],wordlist[wid][3],activestage,false,-1,2);
				}
			}
			if (wordcategoryopen=="Verb"||wordcategoryopen=="Suffix|V")
			{
				document.getElementById("tab_inflect_li").style.display="initial";
				temp+=tableVerb(wordlist[wid][2],wordlist[wid][3],activestage,false,-1);
			}
			
			document.getElementById("inflection_content").innerHTML=temp;
			
			//Set last edited
			//var qq=new Date(wordlist[wid][4]);
			var qq=wordlist[wid][4];
			document.getElementById("word_last_edited_span").innerHTML=qq.toLocaleDateString(undefined,_dataformat);
			
			$('[data-toggle="tooltip"]').tooltip();
		}
	function getSuffix(paipo,stageused)
		{
			var q="";
			if (dbase[paipo][1]==">>-1") paipo-=1;
			if (dbase[paipo][1]==">>-2") paipo-=2;
			if (dbase[paipo][1]==">>-3") paipo-=3;
			if (dbase[paipo][1]==">>-4") paipo-=4;
			return(dbase[paipo][maincolumns[stageused]]);
		}
	function attachSuffix(array,suffix)
		{
			var q=suffix;
			for(var i=0;i<10;i++)
			{
				var p=i;
				if (p>=array.length) p=0;
				var t=array[p];
				if (t.charAt(t.length-1)=="-") t=t.slice(0,-1);
				q=q.replace(i+"-",t);
			}
			return(q);
		}
	function updateStage()
		{
			activestage=document.getElementById("stageselectlist").selectedIndex;
			//Clear search bar
			document.getElementById("searchinputvalue").value="";
			//Load stage
			loadStage(activestage);	
		}
	function formatCognate(input,addmeaning,ispieroot)
		{
			var tf=input[1].split("=");
			var ts=getLangName(input[0]);
			var output="";
			if (input[0].charAt(0)!="!") output=ts+" ";
			else
			{
				input[0]=input[0].slice(1);
				ts=getLangName(input[0]);
			}
			if (tf.length==1) output+="<i>";
			output+='<a href="'+getWiktionaryLink(ts,tf[0])+'" target="_blank">'+asterisk(input[0]);
			if (input[0]=="pie") tf[0]=formatPie(tf[0],ispieroot);
			output+=tf[0]+'</a>';
			if (tf.length==1) output+="</i>";
			if (tf.length>1)
			{
				output+=" (<i>"+tf[1]+"</i>";
				if (addmeaning) output+=", ";
				else output+=")";
			}
			else if (addmeaning) output+=" (";
			output=replaceAll("_"," ",output);
			output=replaceAll("€","_",output);
			return(output);
		}
	function asterisk(krl)
		{
			if (krl=="peus"||krl=="pclt"||krl=="pgmc"||krl=="pslv"||krl=="pie"||krl=="psmt"||krl=="purl") return("*");
			else return("");
		}
	function cleanSearch()
		{
			document.getElementById("searchinputvalue").value="";
			var rv="";
			var radios=document.getElementsByName("search_destination");
			for(var i=0;i<radios.length;i++)
			{
				if (radios[i].checked) rv=radios[i].value;
			}
			searchtarget=rv;
			setWordlist();
			localStorage.setting_searchpurpose=rv;
		}
	function refreshOrder()
		{
			var rv="";
			var radios=document.getElementsByName("lex_order");
			for(var i=0;i<radios.length;i++)
			{
				if (radios[i].checked) rv=radios[i].value;
			}
			if (rv=="alph") orderalph=true;
			else orderalph=false;
			loadStage(activestage);
			localStorage.setting_lexorder=rv;
		}
	function adjStem(stem,decpattern)
		{
			var ptn=dbase[decpattern-1][1];
			if (activestage>1)
			{
				if (ptn.includes("AA")) stem=stem.replace("0-","1-");
			}
			return(stem);
		}
	function parseLoan(arg0,arg1)
		{
			var tt="";
			if (arg0[0]=="MED") tt="of Mediterranean origin";
			else if (arg0[0]=="artlib"||arg0[0]=="substrate") tt="further origin unknown";
			else if (arg0[0]=="ww") tt="from an ancient Wanderwort";
			else tt="loaned from "+formatCognate([arg0[0],(arg0[1].split("/"))[0]],true)+'“'+replaceAll("_"," ",(arg0[1].split("/"))[1])+'”) prior to '+arg1;
			return(tt);
		}
	function etymoStep(stage,word,meaning,showlangname)
		{
			showlangname = typeof showlangname !== 'undefined' ? showlangname : true;
			var t="";
			if (showlangname) t=stagelist[stage][0]+" ";
			var qq=dbase[word][maincolumns[stage]];
			//Get word
			var tt="<a href='javascript:void(0);' class='clickety' onclick='timeTravel("+word+","+stage+")'>"+apply_orthography(qq,stage)+"</a>";
			if (!_needsromanisation[stage]) tt="<i>"+tt+"</i>";
			t+=tt;
			if (_needsromanisation[stage]||meaning!="") t+=" (";
			if (_needsromanisation[stage])
			{
				t+="<i>"+apply_romanisation(qq,stage)+"</i>";
				if (meaning!="") t+=", ";
			}
			if (meaning!="")
			{
				var meaningdisp="";
				var mengar=meaning.split(",");
				for(var i=0;i<mengar.length;i++)
				{
					if (i<3)
					{
						if (meaningdisp!="") meaningdisp+=", ";
						mengar[i]=mengar[i].split("£")[0];
						meaningdisp+=mengar[i];
					}
					else
					{
						i=mengar.length;
						meaningdisp+=", etc.";
					}
				}
				t+="“"+replaceAll("_"," ",meaningdisp)+"”";
			}
			if (_needsromanisation[stage]||meaning!="") t+=")";
			return(t);
		}
	function timeTravel(word,stage)
		{
			if (document.getElementById("stageselectlist").selectedIndex!=stage)
			{
				document.getElementById("stageselectlist").selectedIndex=stage;
				updateStage();
			}
			var wlist=-1;
			for(var i=0;i<wordlist.length;i++)
			{
				if (wordlist[i][2]==word)
				{
					wlist=i;
					i=wordlist.length;
				}
			}
			if (wlist>-1) openWord(wlist,false);
			switch_tab(0);
		}
	function parseEtymoText(txt,stage)
		{
			var newtxt="";
			var barray=txt.split(" ");
			for(var i=0;i<barray.length;i++) //Do links
			{
				if (i>0) newtxt+=" ";
				if (barray[i].includes("@"))
				{
					//It's a link!
					var addtoend="";
					if (barray[i].substr(-1)=="."||barray[i].substr(-1)==","||barray[i].substr(-1)=="?"||barray[i].substr(-1)==")"||barray[i].substr(-1)==";")
					{
						addtoend=barray[i].substr(-1);
						barray[i]=barray[i].substring(0,barray[i].length-1);
					}
					newtxt+=formatCognate(barray[i].split("@"),false)+addtoend;
				}
				else newtxt+=barray[i];
			}
			txt=newtxt;
			//Cases
			for(var i=0;i<glossterms.length;i++) txt=replaceAll("$"+glossterms[i][0],glossText(glossterms[i][0],glossterms[i][1]),txt);
			//Sources
			for(var i=0;i<sources.length;i++)
			{
				var tempvar=sources[i][1].split(",");
				txt=replaceAll("§"+sources[i][0],"<span class='hovertext' data-placement='top' title='"+sources[i][1].replace(/<\/?i>/g,"")+".' data-toggle='tooltip'>"+tempvar[0]+" ("+tempvar[tempvar.length-1].trim()+")</span>",txt);
			}
			//Minor formatting
			txt=replaceAll(" - ","—",txt);
			txt=replaceAll("<<","⟨",txt);
			txt=replaceAll(">>","⟩",txt);
			//Links
			if (stage>-1)
			{
			for(var i=0;i<_uidlist.length;i++)
				{
					var qq=apply_orthography(dbase[_uidlist[i][1]][maincolumns[stage]],stage);
					var pp="";
					if (stage!=0) qq="<i>"+qq+"</i>";
					else pp=" (<i>"+apply_romanisation(dbase[_uidlist[i][1]][maincolumns[stage]],stage)+"</i>)";
					txt=replaceAll("°"+_uidlist[i][0]+"°","<a class='clickety' href='javascript:void(0);' onclick='timeTravel("+_uidlist[i][1]+","+stage+");'>"+qq+"</a>"+pp,txt);
					txt=replaceAll("€"+_uidlist[i][0]+"€",qq+pp,txt);
				}
			}
			return(txt);
		}
	function glossText(txt,hover)
		{
			return("<span class='glosstext' data-placement='top' title='"+hover+"' data-toggle='tooltip'>"+txt+"</span>");
		}
	function returnGloss(txt)
		{
			for(var i=0;i<glossterms.length;i++) if (txt==glossterms[i][0]) return(glossterms[i][1]);
			return("<error>");
		}
	function switch_tab(tabid)
		{
			document.getElementById("head_container_lexicon").style.display="none";
			document.getElementById("head_container_docu").style.display="none";
			document.getElementById("secnavsearchbar").style.display="none";
			document.getElementById("navbar_button_lexicon").classList.remove("active");
			document.getElementById("navbar_button_docs").classList.remove("active");
			document.getElementById("main_header_element").classList.remove("sticky-top");
			if (_navbarcontent=="") _navbarcontent=document.getElementById("navbar_alphabetlist").innerHTML;
			if (tabid>0) document.getElementById("lang_name").innerHTML="CARITE";
			switch(tabid)
			{
				case 0:
					document.getElementById("head_container_lexicon").style="";
					document.getElementById("lang_name").innerHTML=stagelist[_currentstage][0].toUpperCase();
					document.getElementById("navbar_alphabetlist").innerHTML=_navbarcontent;
					document.getElementById("secnavsearchbar").style.display="";
					_navbarcontent="";
					_viewinglexicon=true;
					document.getElementById("navbar_button_lexicon").classList.add("active");
					break;
				case 1:
					document.getElementById("head_container_docu").style="";
					document.getElementById("navbar_alphabetlist").innerHTML="";
					prepDoc();
					_viewinglexicon=false;
					document.getElementById("navbar_button_docs").classList.add("active");
					document.getElementById("main_header_element").classList.add("sticky-top");
					break;
				}
		}
	function render_bibliography()
		{
			//Make a new temporary array with all sources plus amount of references
			var sourcelist=[];
			for(var i=0;i<sources.length;i++) sourcelist.push([sources[i][0],0]);
			//Go through document to sum up references
			for(var i=4;i<dbase.length;i++)
			{
				var refre=dbase[i][sourcecolumn];
				if (refre!="")
				{
					var toarray=refre.split(",");
					for(var j=0;j<toarray.length;j++)
					{
						var kolo=(toarray[j].split(" "))[0];
						var found=false;
						for(var k=0;k<sourcelist.length;k++)
						{
							if (sourcelist[k][0]==kolo)
							{
								sourcelist[k][1]++;
								found=true;
							}
						}
						if (!found&&kolo.charAt(0)!=">") console.log("Unable to recognise "+kolo+" in lexicon "+i+"!");
					}
				}
			}
			//Also go through documentation
			for(var i=0;i<_documentation_bibliography.length;i++)
			{
				var toarray=_documentation_bibliography[i][1].split(",");
				for(var j=0;j<toarray.length;j++)
				{
					var kolo=(toarray[j].split(" "))[0];
					var found=false;
					for(var k=0;k<sourcelist.length;k++)
					{
						if (sourcelist[k][0]==kolo)
						{
							sourcelist[k][1]++;
							found=true;
						}
					}
					if (!found&&kolo.charAt(0)!=">") console.log("Unable to recognise "+kolo+" in documentation "+i+"!");
				}
			}
			var newlist=[];
			var newlist2=[];
			for(var i=0;i<sourcelist.length;i++)
			{
				if (sourcelist[i][1]>0) newlist.push(sourcelist[i][0]+" "+sourcelist[i][1]);
				else newlist2.push(sourcelist[i][0]);
			}
			inbibliography=true;
			var temp=list_sources(newlist);
			inbibliography=false;
			document.getElementById("bibliography_ollist").innerHTML=temp;
			temp=list_sources(newlist2);
			document.getElementById("bibliography_ollist2").innerHTML=temp;
		}
	function list_sources(arraysource)
		{
			var qp=arraysource;
			var temp="";
			for(var i=0;i<sources.length;i++)
			{
				for(var j=0;j<qp.length;j++)
				{
					var ktk=qp[j].split(" ");
					if (sources[i][0]==ktk[0])
					{
						temp+="<li>"+sources[i][1]+".";
						if (ktk.length>1)
						{
							if (inbibliography)
							{
								temp+=" "+ktk[1]+" reference";
								if (ktk[1]!=1) temp+="s";
								temp+=".";
							}
							else
							{
								temp+=" Page";
								if (ktk[1].includes("-")||ktk[1].includes("+")) temp+="s";
								temp+=" "+replaceAll("+",", ",ktk[1])+".";
							}
						}
						temp+=" ";
						for(var k=0;k<sources[i][2].length;k++)
						{
							if (k>0) temp+=" ";
							temp+="<a target='_blank' href='"+sources[i][2][k][1]+"'>";
							switch(sources[i][2][k][0])
							{
								case "google": temp+="<i alt='Google' title='Google' class='bi bi-google'></i>";break;
								case "academia": temp+="<img alt='Academia' title='Academia' class='img_src_inline' src='logos/academia.svg'>";break;
								case "archive": temp+="<img alt='Internet Archive' title='Internet Archive' class='img_src_inline' src='logos/archive.svg'>";break;
								case "jstor": temp+="<img alt='JSTOR' title='JSTOR' class='img_src_inline' src='logos/jstor.png'>";break;
								case "worldcat": temp+="<img alt='WorldCat' title='WorldCat' class='img_src_inline' src='logos/worldcat.png'>";break;
								case "directlink": temp+="<i alt='External link' title='External link' class='fas fa-external-link-alt'></i>";break;
							}
							temp+="</a>";
						}
						temp+="</li>";
					}
				}
			}
			return(temp);
		}
	function getComparative(stem,stage)
		{
			var out=stem;
			if (stage==0)
			{
				//Iotacise ty dy
				var q=stem.split("");
				var p=q.pop();
				if (p=="t") q.push("s");
				else if (p=="d") q.push("z");
				else
				{
					stem+="j";
					//Vocalise
					stem=stem.replace(/([mnpbtdkgfvszrlj])(w)(j)/g,"$1u$3");
					//Sonorant!
					stem=stem.replace(/([npbtdkgfvszrljw])(m)(j)/g,"$1um$3");
					stem=stem.replace(/([mpbtdkgfvszrljw])(n)(j)/g,"$1ən$3");
					stem=stem.replace(/([mnpbtdkgfvszljw])(r)(j)/g,"$1ər$3");
					stem=stem.replace(/([mnpbtdkgfvszrjw])(l)(j)/g,"$1əl$3");
					//Colour schwa
					stem=stem.replace(/([pbmfv])(ə)/g,"$1u");
					stem=stem.replace(/ə/g,"i");
					//Destroy preceding geminates
					stem=stem.replace(/([mnpbtdkgfvszrljw])\1(j)/g,"$1j");
					//If ending on a double jj, remove
					if (stem.endsWith("jj")) stem=stem.substring(0,stem.length-1);
					q=stem.split("");
				}
				out=q.join("");
			}
			return(out);
		}
//Tables
	function tablePersPronoun(person,stage)
		{
			var kluku=-1;
			for(var i=0;i<declensionlist.length;i++) if (declensionlist[i][0]==person) kluku=declensionlist[i][1]+1;
			var temp='<table class="table w-auto table-sm"><thead>';
			var beq=_conjunctivelist[stage];
			var bep=_atonics[stage];
			//Add conjunctives later!
			temp+="<tr><th colspan='"+(3+bep*2)+"' scope='col'>"+dbase[kluku-1][stagelist[stage][1]]+"</th></tr>";
			temp+="<tr><th scope='col'></th><th scope='col' colspan='"+(bep+1)+"'>"+glossText("sg",returnGloss("sg"))+"</th><th scope='col' colspan='"+(bep+1)+"'>"+glossText("pl",returnGloss("pl"))+"</th></tr>";
			if (bep)
			{
				temp+="<tr><th scope='col'></th>"
				for(var i=0;i<2;i++) temp+="<th scope='col'>"+glossText("ton",returnGloss("ton"))+"</th><th scope='col'>"+glossText("atn",returnGloss("atn"))+"</th>"
					temp+="</tr>";
			}
			temp+="</thead><tbody>";
			for(var i=0;i<_caseslist[0].length;i++)
			{
				if (_caseslist[stage][i]!="")
				{
					temp+="<tr><th scope='row'>"+glossText(_caseslist[stage][i],returnGloss(_caseslist[stage][i]))+"</th>";
					temp+="<td>"+apply_orthography(getSuffix(kluku+i*2,stage),stage)+"</td>";
					if (bep) temp+="<td>"+apply_orthography(getSuffix(kluku+1+i*2,stage),stage)+"</td>";
					temp+="<td>"+apply_orthography(getSuffix(kluku+i*2+_caseslist[0].length*2,stage),stage)+"</td>";
					if (bep) temp+="<td>"+apply_orthography(getSuffix(kluku+1+i*2+_caseslist[0].length*2,stage),stage)+"</td>";
					temp+="</tr>";
				}
			}
			temp+="</tbody></table>";
			return(temp);
		}
	function tablePronounIrregular(person,stage)
		{
			var kluku=-1;
			for(var i=0;i<declensionlist.length;i++) if (declensionlist[i][0]==person) kluku=declensionlist[i][1]+1;
			var temp='<table class="table w-auto table-sm"><thead>';
			var beq=_conjunctivelist[stage];
			//Add conjunctives later!
			temp+="<tr><th colspan='7' scope='col'>"+dbase[kluku-1][stagelist[stage][1]]+"</th></tr>";
			//
			temp+="<tr><th></th>";
			for(var j=0;j<3;j++) temp+="<th colspan='2'>"+glossText(_genders[stage][j],returnGloss(_genders[stage][j]))+"</th>";
			temp+="</tr><tr>";
			temp+="<th></th>";
			for(var j=0;j<3;j++) temp+="<th>"+glossText("sg",returnGloss("sg"))+"</th><th>"+glossText("pl",returnGloss("pl"))+"</th>";
			temp+="</tr>";
			//
			temp+="</thead><tbody>";
			for(var i=0;i<_caseslist[0].length;i++)
			{
				if (_caseslist[stage][i]!="")
				{
					temp+="<tr><th scope='row'>"+glossText(_caseslist[stage][i],returnGloss(_caseslist[stage][i]))+"</th>";
					temp+="<td>"+apply_orthography(getSuffix(kluku+i,stage),stage)+"</td>";
					temp+="<td>"+apply_orthography(getSuffix(kluku+i+_caseslist[0].length,stage),stage)+"</td>";
					temp+="<td>"+apply_orthography(getSuffix(kluku+i+_caseslist[0].length*2,stage),stage)+"</td>";
					temp+="<td>"+apply_orthography(getSuffix(kluku+i+_caseslist[0].length*3,stage),stage)+"</td>";
					temp+="<td>"+apply_orthography(getSuffix(kluku+i+_caseslist[0].length*4,stage),stage)+"</td>";
					temp+="<td>"+apply_orthography(getSuffix(kluku+i+_caseslist[0].length*5,stage),stage)+"</td>";
					temp+="</tr>";
				}
			}
			temp+="</tbody></table>";
			return(temp);
		}
	function tableNoun(dbaserow,pattern,stage,indicategender,isdoc)
		{
			var stemarray=dbase[dbaserow][maincolumns[stage]].split("~");
			//Figure out raw stem of the first index
			var klaka=((stemarray[0].split("")).reverse()).join(""); //Reverse
			//Get precise moment
			var kluku=-1;
			for(var i=0;i<declensionlist.length;i++) if (declensionlist[i][0]==pattern) kluku=declensionlist[i][1]+1;
			//Check if not a reference!
			if (dbase[kluku-1][stagelist[stage][1]].charAt(0)==">")
			{
				var newdb=dbase[kluku-1][stagelist[stage][1]].replace(">","");
				for(var i=0;i<declensionlist.length;i++) if (declensionlist[i][0]==newdb) kluku=declensionlist[i][1]+1;
			}
			var kloko=(((dbase[kluku][maincolumns[stage]].replace("0-","")).split("")).reverse()).join("");
			klaka=klaka.replace(kloko,"");
			stemarray[0]=((klaka.split("")).reverse()).join(""); //Reverse
			
			if (indicategender)
			{
				document.getElementById("dicentry_gender").style.display="initial";
				document.getElementById("dicentry_gender2").innerHTML=dbase[kluku-1][stagelist[stage][1]+1];
			}
			
			var temp='<table class="table w-auto table-sm"><thead>';
			var beq=_conjunctivelist[stage];
			temp+="<tr><th colspan='"+(3+beq*2)+"' scope='col'>"+dbase[kluku-1][stagelist[stage][1]]+"</th></tr>";
			if (isdoc>-1) temp+="<tr><td style='text-align:center;' colspan='"+(3+beq*2)+"' scope='col'>(ex. <a class='clickety' href='javascript:void(0);' onclick='timeTravel("+dbaserow+","+stage+");'>"+apply_orthography((dbase[dbaserow][maincolumns[stage]].split("~"))[0],stage)+"</a> <a class='clickety' onclick='findNewTable("+isdoc+",\""+pattern+"\","+stage+",false);'><i class='fas fa-redo'></i></a> <a class='clickety' onclick='findNewTable("+isdoc+",\""+pattern+"\","+stage+",true);'><i class='far fa-sticky-note'></i></a>)</td></tr>";
			if (beq) temp+="<tr><th scope='col'></th><th scope='col' colspan='2'>"+glossText("prm",returnGloss("prm"))+"</th><th scope='col' colspan='2'>"+glossText("cnj",returnGloss("cnj"))+"</th></tr>";
			temp+='<tr><th scope="col"></th>';
			for(var i=0;i<=beq;i++) temp+='<th scope="col">'+glossText("sg",returnGloss("sg"))+'</th><th scope="col">'+glossText("pl",returnGloss("pl"))+"</th>";
			temp+="</tr></thead><tbody>";
			
			for(var i=0;i<_caseslist[0].length;i++)
			{
				if (_caseslist[stage][i]!=""&&_caseslist[stage][i]!="adv")
				{
					temp+="<tr><th scope='row'>"+glossText(_caseslist[stage][i],returnGloss(_caseslist[stage][i]))+"</th>";
					//singular
					temp+="<td>"+apply_orthography(attachSuffix(stemarray,getSuffix(kluku+i,stage)),stage)+"</td>";
					//plural
					temp+="<td>"+apply_orthography(attachSuffix(stemarray,getSuffix(kluku+_caseslist[0].length+i,stage)),stage)+"</td>";
					if (beq)
					{
						//singular
						temp+="<td>"+apply_orthography(attachSuffix(stemarray,getSuffix(kluku+_caseslist[0].length*2+i,stage)),stage)+"</td>";
						//plural
						temp+="<td>"+apply_orthography(attachSuffix(stemarray,getSuffix(kluku+_caseslist[0].length*3+i,stage)),stage)+"</td>";
					}
					temp+="</tr>";
				}
			}
			temp+="</tbody></table>";
			return(temp);
		}
	function tableAdjective(dbaserow,pattern,stage,iamnumeral,isdoc,iscomparative)
		{
			//If dbaserow is a number look it up, if not split it
			if (Number(dbaserow)===dbaserow) var stemarray=dbase[dbaserow][maincolumns[stage]].split("~");
			else var stemarray=dbaserow.split("~");
			//Figure out raw stem of the first index
			var klaka=((stemarray[0].split("")).reverse()).join(""); //Reverse
			//Get precise moment
			var kluku=-1;
			for(var i=0;i<declensionlist.length;i++) if (declensionlist[i][0]==pattern) kluku=declensionlist[i][1]+1;

			//Figure out which declensions to draw data from
			var decolist=[];
			for(var i=0;i<_genders[stage].length;i++)
			{
				for(var j=0;j<declensionlist.length;j++)
				{
					if (declensionlist[j][0]==dbase[kluku-1][stagelist[stage][1]+1+i]) decolist.push(declensionlist[j][1]+1);
				}
			}
			
			temp="Error loading declension! Please get in touch to report this bug.";
			if (decolist.length>0)
			{
				var kloko=(((dbase[decolist[0]][maincolumns[stage]].replace("0-","")).split("")).reverse()).join("");
				klaka=klaka.replace(kloko,"");
				stemarray[0]=((klaka.split("")).reverse()).join(""); //Reverse
				
				if (iscomparative==1)
				{
					//Get new endings
					pattern="COMPARATIVE";
					var kluku=-1;
					for(var i=0;i<declensionlist.length;i++) if (declensionlist[i][0]==pattern) kluku=declensionlist[i][1]+1;
					//Figure out which declensions to draw data from
					var decolist=[];
					for(var i=0;i<_genders[stage].length;i++)
					{
						for(var j=0;j<declensionlist.length;j++)
						{
							if (declensionlist[j][0]==dbase[kluku-1][stagelist[stage][1]+1+i]) decolist.push(declensionlist[j][1]+1);
						}
					}
					stemarray[0]=getComparative(stemarray[0],stage);
				}
				if (iscomparative==2)
				{
					var refff=-1;
					for(var i=0;i<declensionlist.length;i++)
					{
						if (declensionlist[i][0]=="SUPERLATIVE") refff=declensionlist[i][1]+1;
					}
					stemarray[0]=attachSuffix(stemarray,getSuffix(refff,stage));
					//Get new endings
					pattern="ADJ_THEM_UNSTRESSED_DEF";
					var kluku=-1;
					for(var i=0;i<declensionlist.length;i++) if (declensionlist[i][0]==pattern) kluku=declensionlist[i][1]+1;
					//Figure out which declensions to draw data from
					var decolist=[];
					for(var i=0;i<_genders[stage].length;i++)
					{
						for(var j=0;j<declensionlist.length;j++)
						{
							if (declensionlist[j][0]==dbase[kluku-1][stagelist[stage][1]+1+i]) decolist.push(declensionlist[j][1]+1);
						}
					}
				}
			
				temp='<table class="table w-auto table-sm"><thead>';
				temp+="<tr><th colspan='"+(1+decolist.length*(1+(!iamnumeral)))+"' scope='col'>"+dbase[kluku-1][stagelist[stage][1]]+"</th></tr>";
				if (isdoc>-1)
				{
					var qpq=pattern;
					if (iscomparative==2) qpq="SUPERLATIVE";
					temp+="<tr><td style='text-align:center;' colspan='"+(1+decolist.length*(1+(!iamnumeral)))+"' scope='col'>(ex. <a class='clickety' href='javascript:void(0);' onclick='timeTravel("+dbaserow+","+stage+");'>"+apply_orthography((dbase[dbaserow][maincolumns[stage]].split("~"))[0],stage)+"</a> <a class='clickety' onclick='findNewTable("+isdoc+",\""+qpq+"\","+stage+",false);'><i class='fas fa-redo'></i></a> <a class='clickety' onclick='findNewTable("+isdoc+",\""+qpq+"\","+stage+",true);'><i class='far fa-sticky-note'></i></a>)</td></tr>";
				}
				temp+="</thead><tbody>";
				for(var i=0;i<=_conjunctivelist[stage];i++)
				{
					if (_conjunctivelist[stage])
					{
						temp+="<tr><th colspan='"+(1+decolist.length*(1+(!iamnumeral)))+"' scope='col'>";
						if (i==0) temp+=glossText("prm",returnGloss("prm"));
						else temp+=glossText("cnj",returnGloss("cnj"));
						temp+="</th></tr>";
					}
						//Genders + number
						temp+="<tr><th></th>";
						for(var j=0;j<decolist.length;j++) temp+="<th colspan='"+(1+!(iamnumeral))+"'>"+glossText(_genders[stage][j],returnGloss(_genders[stage][j]))+"</th>";
						temp+="</tr><tr>";
						if (!iamnumeral)
						{
							temp+="<th></th>";
							for(var j=0;j<decolist.length;j++) temp+="<th>"+glossText("sg",returnGloss("sg"))+"</th><th>"+glossText("pl",returnGloss("pl"))+"</th>";
							temp+="</tr>";
						}
						for(var j=0;j<_caseslist[0].length;j++)
						{
							if (_caseslist[stage][j]!="")
							{
								temp+="<tr><th scope='row'>"+glossText(_caseslist[stage][j],returnGloss(_caseslist[stage][j]))+"</th>";
								for(var k=0;k<decolist.length;k++)
								{
									//singular
									temp+="<td>"+apply_orthography(attachSuffix(stemarray,adjStem(getSuffix(decolist[k]+_caseslist[0].length*2*i+j,stage),decolist[k])),stage)+"</td>";
									//plural
									if (!iamnumeral) temp+="<td>"+apply_orthography(attachSuffix(stemarray,adjStem(getSuffix(decolist[k]+_caseslist[0].length*(2*i+1)+j,stage),decolist[k])),stage)+"</td>";
								}
								temp+="</tr>";
							}
						}
				}
				
				temp+="</tbody></table>";
			}
			return(temp);
		}
	function tableVerb(dbaserow,pattern,stage,putparticiple,isdoc)
		{
			var stemarray=dbase[dbaserow][maincolumns[stage]].split("~");
			//Figure out raw stem of the first index
			var klaka=((stemarray[0].split("")).reverse()).join(""); //Reverse
			//Get precise moment
			var kluku=-1;
			for(var i=0;i<declensionlist.length;i++) if (declensionlist[i][0]==pattern) kluku=declensionlist[i][1]+1;
			//Check if not a reference!
			if (dbase[kluku-1][stagelist[stage][1]].charAt(0)==">")
			{
				var newdb=dbase[kluku-1][stagelist[stage][1]].replace(">","");
				for(var i=0;i<declensionlist.length;i++) if (declensionlist[i][0]==newdb) kluku=declensionlist[i][1]+1;
			}
			var kloko=(((dbase[kluku][maincolumns[stage]].replace("0-","")).split("")).reverse()).join("");
			klaka=klaka.replace(kloko,"");
			stemarray[0]=((klaka.split("")).reverse()).join(""); //Reverse
			var temp='<table class="table w-auto table-sm"><thead>';
			if (!putparticiple) temp="<h5>Conjugation</h5>"+temp;
			temp+='<tr><th colspan="8" scope="col">'+dbase[kluku-1][stagelist[stage][1]]+"</th></tr></thead><tbody>";
			if (isdoc>-1) temp+="<tr><td style='text-align:center;' colspan='8' scope='col'>(ex. <a class='clickety' href='javascript:void(0);' onclick='timeTravel("+dbaserow+","+stage+");'>"+apply_orthography((dbase[dbaserow][maincolumns[stage]].split("~"))[0],stage)+"</a> <a class='clickety' onclick='findNewTable("+isdoc+",\""+pattern+"\","+stage+",false);'><i class='fas fa-redo'></i></a> <a class='clickety' onclick='findNewTable("+isdoc+",\""+pattern+"\","+stage+",true);'><i class='far fa-sticky-note'></i></a>)</td></tr>";
			for(var i=0;i<_tamlist[stage].length;i++)
			{
				var q=_tamlist[stage][i][0];
				temp+="<tr><th colspan='2' rowspan='2' scope='col'>"+glossText(q,returnGloss(q))+"</th><th colspan='3' scope='col'>"+glossText("sg",returnGloss("sg"))+"</th><th colspan='3' scope='col'>"+glossText("pl",returnGloss("pl"))+"</th></tr>";
				temp+="<tr><th scope='col'>"+glossText("1",returnGloss("1"))+"</th><th scope='col'>"+glossText("2",returnGloss("2"))+"</th><th scope='col'>"+glossText("3",returnGloss("3"))+"</th><th scope='col'>"+glossText("1",returnGloss("1"))+"</th><th scope='col'>"+glossText("2",returnGloss("2"))+"</th><th scope='col'>"+glossText("3",returnGloss("3"))+"</th></tr>";
				for(var j=0;j<_voicelist[stage].length;j++)
				{	
					for(var k=0;k<_tamlist[stage][i][1].length;k++)
					{
						temp+="<tr>";
						if (k==0) temp+="<th scope='col' rowspan='"+_tamlist[activestage][i][1].length+"'>"+glossText(_voicelist[stage][j],returnGloss(_voicelist[stage][j]))+"</th>";
						temp+="<th scope='col'>"+glossText(_tamlist[stage][i][1][k],returnGloss(_tamlist[stage][i][1][k]))+"</th>";
						for(var l=0;l<6;l++)
						{
							var offset=l;//person & number
							offset+=k*6;//tense & aspect
							for(var m=i;m>0;m--) offset+=(_tamlist[stage][m][1].length+1)*6;//mood
							//readd voice (j) whenever relevant again
							//(l+k*6+j*_tamlist[stage][i][1].length*6+i*_tamlist[stage][i][1].length*6*(_voicelist[stage].length+1))
							temp+="<td>"+apply_orthography(attachSuffix(stemarray,getSuffix(kluku+offset,stage)),stage)+"</td>";
						}
						temp+="</tr>";
					}
				}
			}
			//
			if (!(_imperatives[stage][0]==""&&_imperatives[stage][1]==""&&_imperatives[stage][2]==""))
			{
				//Has imperative
				temp+="<tr><th colspan='2' rowspan='3' scope='col'>"+glossText("imp",returnGloss("imp"))+"</th><th colspan='3' scope='col'>"+glossText("sg",returnGloss("sg"))+"</th><th colspan='3' scope='col'>"+glossText("pl",returnGloss("pl"))+"</th></tr>";
				temp+="<tr><th scope='col'>"+glossText("1",returnGloss("1"))+"</th><th scope='col'>"+glossText("2",returnGloss("2"))+"</th><th scope='col'>"+glossText("3",returnGloss("3"))+"</th><th scope='col'>"+glossText("1",returnGloss("1"))+"</th><th scope='col'>"+glossText("2",returnGloss("2"))+"</th><th scope='col'>"+glossText("3",returnGloss("3"))+"</th></tr>";
				temp+="<tr><td></td><td>";
				if (_imperatives[stage][0]=="y") temp+=apply_orthography(attachSuffix(stemarray,getSuffix(kluku+offset+1,stage)),stage);
				temp+="</td><td></td><td>";
				if (_imperatives[stage][1]=="y") temp+=apply_orthography(attachSuffix(stemarray,getSuffix(kluku+offset+2,stage)),stage);
				temp+="</td><td>";
				if (_imperatives[stage][2]=="y") temp+=apply_orthography(attachSuffix(stemarray,getSuffix(kluku+offset+3,stage)),stage);
				temp+="</td><td></td></tr>";
			}
			if (putparticiple)
			{
				//Put participles
				temp+="<tr><th colspan='2' rowspan='2' scope='col'>"+glossText("pcp",returnGloss("pcp"))+"</th><th colspan='3' scope='col'>"+glossText("prs",returnGloss("prs"))+"</th><th colspan='3' scope='col'>"+glossText("pst",returnGloss("pst"))+"</th></tr>";
				temp+="<tr><td scope='col' colspan='3' style='text-align: center;'>"+apply_orthography(attachSuffix(stemarray,getSuffix(kluku+offset+4,stage)),stage)+"</td><td scope='col' colspan='3' style='text-align: center;'>"+apply_orthography(attachSuffix(stemarray,getSuffix(kluku+offset+5,stage)),stage)+"</td></tr>"
			}
			temp+="</tbody></table>";
			if (!putparticiple)
			{
				//Beep boop!
				temp+="<h5>Present Participle</h5>"+tableAdjective(attachSuffix(stemarray,getSuffix(kluku+offset+4,stage)),"ADJ_I_UNSTRESSED_DEF",stage,false,-1,0);
				temp+="<h5>Past Participle</h5>"+tableAdjective(attachSuffix(stemarray,getSuffix(kluku+offset+5,stage)),"ADJ_THEM_STRESSED_DEF",stage,false,-1,0);
			}
			return(temp);
		}
//Other functions
	function updatePieFormat()
		{
			var rv="";
			var radios=document.getElementsByName("use_pooth");
			for(var i=0;i<radios.length;i++)
			{
				if (radios[i].checked) rv=radios[i].value;
			}
			if (rv=="yes")
			{
				__pie.poothstyle=true;
				document.getElementById("glideselect").disabled=true;
				document.getElementById("palatoselect").disabled=true;
				document.getElementById("aspirateselect").disabled=true;
			}
			else
			{
				__pie.poothstyle=false;
				document.getElementById("glideselect").disabled=false;
				document.getElementById("palatoselect").disabled=false;
				document.getElementById("aspirateselect").disabled=false;
				__pie.glides=document.getElementById("glideselect").selectedIndex;
				__pie.palatals=document.getElementById("palatoselect").selectedIndex;
				__pie.aspiration=document.getElementById("aspirateselect").selectedIndex;
			}
			openWord(_last_opened,false);
			document.getElementById("pie_settings_sample").innerHTML=formatPie("gʷr̥hₓḗy h₂ówis, kʷésyo wl̥h₂néh₂ ne est, h₁éḱwons spéḱet, h₁oynom gʰe gʷr̥hₓúm wóǵʰom wéǵʰontm̥, h₁oynomkʷe méǵh₂m̥ bʰórom, h₁oynomkʷe ǵʰménm̥ hₓṓḱu bʰérontm̥",false);
			
			localStorage.setting_usepooth=rv;
			localStorage.setting_pie_glides=document.getElementById("glideselect").selectedIndex;
			localStorage.setting_pie_palatals=document.getElementById("palatoselect").selectedIndex;
			localStorage.setting_pie_aspiration=document.getElementById("aspirateselect").selectedIndex;
			
			$('#searchsettingsmodal').modal('handleUpdate');
		}
	function syncSettings()
		{
			if (typeof(Storage) !== "undefined")
			{
				document.getElementById("localstoragealert").style.display="none";
				//Updates and whatnot
				if (localStorage.lastVersion!==undefined)
				{
					if (localStorage.lastVersion<_siteversion)
					{
						localStorage.lastVersion=_siteversion;
						if (localStorage.changelogOpen=="true") $('#updatemodal').modal('show');
					}
					if (localStorage.changelogOpen=="true") document.getElementById("openUpdateBox").checked=true;
				}
				else
				{
					localStorage.lastVersion=_siteversion;
					localStorage.changelogOpen=true;
				}
				//X-Sampa
				var radios=document.getElementsByName("use_xsampa");
				var rv="";
				if (localStorage.setting_xsampa!==undefined)
				{
					for(var i=0;i<radios.length;i++)
					{
						if (radios[i].value==localStorage.setting_xsampa) radios[i].checked=true;
						else radios[i].checked=false;
					}
				}
				else
				{
					for(var i=0;i<radios.length;i++)
					{
						if (radios[i].checked) rv=radios[i].value;
					}
					localStorage.setting_xsampa=rv;
				}
				updateXSamp(localStorage.setting_xsampa,false);
				//Search bar purpose
				var radios=document.getElementsByName("search_destination");
				if (localStorage.setting_searchpurpose!==undefined)
				{
					for(var i=0;i<radios.length;i++)
					{
						if (radios[i].value==localStorage.setting_searchpurpose) radios[i].checked=true;
						else radios[i].checked=false;
					}
				}
				else
				{
					for(var i=0;i<radios.length;i++)
					{
						if (radios[i].checked) rv=radios[i].value;
					}
					localStorage.setting_searchpurpose=rv;
				}
				cleanSearch();
				//Search bar order
				var radios=document.getElementsByName("lex_order");
				if (localStorage.setting_lexorder!==undefined)
				{
					for(var i=0;i<radios.length;i++)
					{
						if (radios[i].value==localStorage.setting_lexorder) radios[i].checked=true;
						else radios[i].checked=false;
					}
				}
				else
				{
					for(var i=0;i<radios.length;i++)
					{
						if (radios[i].checked) rv=radios[i].value;
					}
					localStorage.setting_lexorder=rv;
				}
				refreshOrder();
				//PIE Formatting
					//Pooth
				var radios=document.getElementsByName("use_pooth");
				if (localStorage.setting_usepooth!==undefined)
				{
					for(var i=0;i<radios.length;i++)
					{
						if (radios[i].value==localStorage.setting_usepooth) radios[i].checked=true;
						else radios[i].checked=false;
					}
				}
				else
				{
					for(var i=0;i<radios.length;i++)
					{
						if (radios[i].checked) rv=radios[i].value;
					}
					localStorage.setting_usepooth=rv;
				}
					//Glides
				if (localStorage.setting_pie_glides!==undefined) document.getElementById("glideselect").selectedIndex=localStorage.setting_pie_glides;
				else localStorage.setting_pie_glides=document.getElementById("glideselect").selectedIndex;
					//Palatalovelars
				if (localStorage.setting_pie_palatals!==undefined) document.getElementById("palatoselect").selectedIndex=localStorage.setting_pie_palatals;
				else localStorage.setting_pie_palatals=document.getElementById("palatoselect").selectedIndex;
					//Aspiration
				if (localStorage.setting_pie_aspiration!==undefined) document.getElementById("aspirateselect").selectedIndex=localStorage.setting_pie_aspiration;
				else localStorage.setting_pie_aspiraton=document.getElementById("aspirateselect").selectedIndex;
				updatePieFormat();
			}
			//Archaic formatting
			/*if (localStorage.showArchaic!==undefined)
			{
				showarchaic=localStorage.showArchaic;
				if (localStorage.showArchaic=="true") document.getElementById("showArchaicBox").checked=true;
			}
			else
			{
				localStorage.showArchaic=false;
			}
			updateArchaicBox();*/
			//Put changelog in place too
			var t="";
			for(var i=0;i<_changelog.length;i++)
			{
				t+="<b>"+_changelog[i][0].toLocaleDateString(undefined,{ weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })+"</b><ul>";
				for(var j=1;j<_changelog[i].length;j++) t+="<li>"+_changelog[i][j]+"</li>";
				t+="</ul>";
			}
			document.getElementById("updatemodalbody").innerHTML=t;
		}
	function collapseIfMobile()
		{
			var q=getViewport();
			if (q=="sm"||q=="xs") $('#wordlist').collapse("toggle");
		}
		
	function updateOpenUpdateBox()
		{
			localStorage.changelogOpen=document.getElementById("openUpdateBox").checked;
		}
		
	function updateArchaicBox()
		{
			showarchaic=document.getElementById("showArchaicBox").checked;
			localStorage.showArchaic=showarchaic;
			loadStage(activestage);
			openWord(_last_opened,false);
		}
		
	function updateXSamp(val,update)
		{
			if (val=="ipa") usexsampa=false;
			else usexsampa=true;
			if (update) openWord(_last_opened,false);
		}
		
		function getViewport () {
		  // https://stackoverflow.com/a/8876069
		  const width = Math.max(
		    document.documentElement.clientWidth,
		    window.innerWidth || 0
		  )
		  if (width <= 576) return 'xs'
		  if (width <= 768) return 'sm'
		  if (width <= 992) return 'md'
		  if (width <= 1200) return 'lg'
		  return 'xl'
		}
		$('input[type=radio][name=use_xsampa]').change(function() {
		    updateXSamp(this.value,true);
			localStorage.setting_xsampa=this.value;
		});
		
	function scrollToValue(ref)
		{
			document.getElementById(ref).scrollIntoView({behavior: "smooth"});
		}
		
//Debug
	function toggleDebugMode()
		{
			//This not-so-hidden-if-you-look-well function actives debug mode on the site
			if (localStorage.settings_secretdebug=="true") localStorage.settings_secretdebug=false;
			else localStorage.settings_secretdebug=true;
			location.reload();
		}
		
	function getPhonotactics(stage)
		{
			var temp="";
			var structure=[];
			var k=[];
			var ipaorder="mnɲŋpbtdkɡszʃʒɸβfvθðxɣχʁhwjɾrlʎ";
			for(var i=3;i<__endoflexicon;i++)
			{
				//Get pronunciation
				temp=dbase[i][maincolumns[stage]].toLowerCase();
				temp=getPronunciation((temp.split("~"))[0]);
				//Get phonemic part
				temp=(temp.split(","))[0];
				temp=temp.replace(/\//g,"");
				temp=temp.replace("ˈ","");
				temp=temp.replace("-","");
				k=temp.split(".");
				for(var j=0;j<k.length;j++)
				{
					if (!structure.includes(k[j])) structure.push(k[j]);
				}
			}
			//Rough structure
			temp="<p>The syllable structure of "+stagelist[stage][0]+" may be described as ";
			var minn=[9,9];
			var maxx=[0,0];
			var on=[];
			var cod=[];
			var engnum=["Mono","Di","Tri","Tetra","Penta"];
			k=[];
			for(var i=0;i<structure.length;i++)
			{
				for(var j=0;j<structure[i].length;j++)
				{
					if (_vowels[stage].includes(structure[i].charAt(j)))
					{
						if (j<minn[0]) minn[0]=j;
						if (j>maxx[0]) maxx[0]=j;
						var kkk=structure[i].substring(0,j);
						if (!on.includes(kkk)&&kkk!=""&&kkk.charAt(0)!="["&&kkk.charAt(0)!="-") on.push(kkk);
						if (structure[i].charAt(j+1)=="ː") j++;
						if (structure[i].charAt(j+1)=="ː") j++;
						if (structure[i].length-j-1<minn[1]) minn[1]=structure[i].length-j-1;
						if (structure[i].length-j-1>maxx[1]) maxx[1]=structure[i].length-j-1;
						kkk=structure[i].substring(j+1,structure[i].length);
						if (!cod.includes(kkk)&&kkk!=""&&!kkk.includes("]")) cod.push(kkk);
						j=99;
					}
				}
			}
			for(var i=0;i<minn[0];i++) temp+="C";
			for(var i=minn[0];i<maxx[0];i++) temp+="(C)";
			temp+="V";
			for(var i=0;i<minn[1];i++) temp+="C";
			for(var i=minn[1];i<maxx[1];i++) temp+="(C)";
			temp+=".</p>";
			on.sort(function(a,b){return sortByString(a,b,ipaorder)});
			cod.sort(function(a,b){return sortByString(a,b,ipaorder)});
			//Process
			for(var h=0;h<2;h++)
			{
				if (h==0) temp+="<h3>Onsets</h3>";
				else temp+="<h3>Codas</h3>";
				var onsetsub=[];
				for(var i=0;i<6;i++) onsetsub.push([]);
					//Subdivide depending on length
				if (h==0) for(var i=0;i<on.length;i++) onsetsub[on[i].length-1].push(on[i]);
				else for(var i=0;i<cod.length;i++) onsetsub[cod[i].length-1].push(cod[i]);
					//Process
				for(var i=5;i>-1;i--)
				{
					if (onsetsub[i].length>0)
					{
						temp+="<h4>"+engnum[i]+"consonantal</h4><p>";
						//Pack into rule
						var gg=[];
						for(var j=0;j<=i;j++) gg.push([]);
						for(var j=0;j<onsetsub[i].length;j++)
						{
							for(var k=0;k<=i;k++) if (!gg[k].includes(onsetsub[i][j].charAt(k))) gg[k].push(onsetsub[i][j].charAt(k));
						}
						for(var j=0;j<gg.length;j++)
						{
							if (gg[j].length>1) temp+="{";
							for(var k=0;k<gg[j].length;k++)
							{
								if (k>0) temp+=",";
								temp+=gg[j][k];
							}
							if (gg[j].length>1) temp+="}";
						}
						//Give list
						temp+="The following can be found:<ul>"
						for(var j=0;j<onsetsub[i].length;j++) temp+="<li>"+onsetsub[i][j]+"</li>";
						temp+="</ul></p>";
					}
				}
			}
			
			return(temp);
		}
</script>
<script src="documentation.js"></script>
<script src="soundchangeparser.js"></script>
</html>